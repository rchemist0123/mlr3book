<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Natalie Foss">
<meta name="author" content="Lars Kotthoff">
<title>Flexible and Robust Machine Learning Using mlr3 in R - 2&nbsp; Fundamentals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./performance.html" rel="next">
<link href="./intro.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating slimcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentals</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Flexible and Robust Machine Learning Using mlr3 in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mlr-org/mlr3book/tree/main/book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="./Flexible-and-Robust-Machine-Learning-Using-mlr3-in-R.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Getting Started</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./performance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Resampling and Benchmarking</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Hyperparameter Optimization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feature-selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Feature Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pipelines.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pipelines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Preprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./special.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Special Tasks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./technical.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Technical</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpretation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Interpretation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extending.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Extending</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Appendices</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solutions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Solutions to exercises</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glossary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Glossary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tasks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview-tables.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Overview Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Session Info</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-tasks" id="toc-sec-tasks" class="nav-link active" data-scroll-target="#sec-tasks"><span class="toc-section-number">2.1</span>  Tasks</a>
  <ul class="collapse">
<li><a href="#sec-tasks-built-in" id="toc-sec-tasks-built-in" class="nav-link" data-scroll-target="#sec-tasks-built-in"><span class="toc-section-number">2.1.1</span>  Built-in Tasks</a></li>
  <li><a href="#sec-retrieve-data" id="toc-sec-retrieve-data" class="nav-link" data-scroll-target="#sec-retrieve-data"><span class="toc-section-number">2.1.2</span>  Retrieving Data</a></li>
  <li><a href="#sec-tasks-mutators" id="toc-sec-tasks-mutators" class="nav-link" data-scroll-target="#sec-tasks-mutators"><span class="toc-section-number">2.1.3</span>  Task Mutators</a></li>
  <li><a href="#sec-tasks-roles" id="toc-sec-tasks-roles" class="nav-link" data-scroll-target="#sec-tasks-roles"><span class="toc-section-number">2.1.4</span>  Roles (Rows and Columns)</a></li>
  </ul>
</li>
  <li>
<a href="#sec-learners" id="toc-sec-learners" class="nav-link" data-scroll-target="#sec-learners"><span class="toc-section-number">2.2</span>  Learners</a>
  <ul class="collapse">
<li><a href="#sec-training" id="toc-sec-training" class="nav-link" data-scroll-target="#sec-training"><span class="toc-section-number">2.2.1</span>  Training the learner</a></li>
  <li><a href="#sec-predicting" id="toc-sec-predicting" class="nav-link" data-scroll-target="#sec-predicting"><span class="toc-section-number">2.2.2</span>  Predicting</a></li>
  <li><a href="#sec-predict-type" id="toc-sec-predict-type" class="nav-link" data-scroll-target="#sec-predict-type"><span class="toc-section-number">2.2.3</span>  Changing the Prediction Type</a></li>
  </ul>
</li>
  <li><a href="#sec-eval" id="toc-sec-eval" class="nav-link" data-scroll-target="#sec-eval"><span class="toc-section-number">2.3</span>  Evaluation</a></li>
  <li>
<a href="#sec-classif" id="toc-sec-classif" class="nav-link" data-scroll-target="#sec-classif"><span class="toc-section-number">2.4</span>  Classification</a>
  <ul class="collapse">
<li><a href="#sec-classif-tsks" id="toc-sec-classif-tsks" class="nav-link" data-scroll-target="#sec-classif-tsks"><span class="toc-section-number">2.4.1</span>  Classification Tasks</a></li>
  <li><a href="#sec-classif-lrns" id="toc-sec-classif-lrns" class="nav-link" data-scroll-target="#sec-classif-lrns"><span class="toc-section-number">2.4.2</span>  Classification Learners</a></li>
  <li><a href="#sec-classif-eval" id="toc-sec-classif-eval" class="nav-link" data-scroll-target="#sec-classif-eval"><span class="toc-section-number">2.4.3</span>  Classification Evaluation</a></li>
  <li><a href="#sec-binary-classif" id="toc-sec-binary-classif" class="nav-link" data-scroll-target="#sec-binary-classif"><span class="toc-section-number">2.4.4</span>  Binary Classification and Positive Classes</a></li>
  <li><a href="#sec-thresholding" id="toc-sec-thresholding" class="nav-link" data-scroll-target="#sec-thresholding"><span class="toc-section-number">2.4.5</span>  Thresholding</a></li>
  </ul>
</li>
  <li><a href="#sec-task-types-add" id="toc-sec-task-types-add" class="nav-link" data-scroll-target="#sec-task-types-add"><span class="toc-section-number">2.5</span>  Additional Task Types</a></li>
  <li>
<a href="#sec-lrns-add" id="toc-sec-lrns-add" class="nav-link" data-scroll-target="#sec-lrns-add"><span class="toc-section-number">2.6</span>  Additional Learners</a>
  <ul class="collapse">
<li><a href="#sec-lrns-add-list" id="toc-sec-lrns-add-list" class="nav-link" data-scroll-target="#sec-lrns-add-list"><span class="toc-section-number">2.6.1</span>  Listing Learners</a></li>
  </ul>
</li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">2.7</span>  Exercises</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mlr-org/mlr3book/edit/main/book/basics.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/mlr-org/mlr3book/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/mlr-org/mlr3book/blob/main/book/basics.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-basics" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentals</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Natalie Foss 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Wyoming
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    Lars Kotthoff <a href="https://orcid.org/0000-0003-4635-6873" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Wyoming
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    We describe and explain the basic building blocks of mlr3 and how to train and evaluate simple machine learning models. The chapter introduces the different types of tasks that mlr3 supports and how to work with them, learners and how to train models, how to make predictions using those trained models, and how to evaluate the quality of the predictions in a principled fashion. Only the basic concepts are introduced, but we give pointers on where to learn more in the rest of the book, and overviews of other concepts. After reading this chapter, you will be able to use mlr3 for most machine learning workflows.
  </div>
</div>

</header><p>In this chapter, we will introduce the <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> objects and corresponding <a href="https://cran.r-project.org/package=R6"><code>R6</code></a> classes that implement the essential building blocks of machine learning. These building blocks include the data (and the methods of creating training and test sets), the machine learning algorithm (and its training and prediction process), and evaluation measures to assess the quality of predictions.</p>
<p>In essence, machine learning means learning relationships from data. In supervised learning, datasets consist of observations (rows in tabular data) that are labeled, which means that each data point includes features (columns in tabular data) and a quantity that we are trying to predict, also called ‘target’. For example, we might want to predict the miles per gallon a car gets based on features such as its horsepower and the number of gears. Data and information on what they represent, along with what quantities to predict are called “tasks” in <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> (<a href="tasks.html"><span>Appendix&nbsp;C</span></a>) – they can be thought of as machine learning tasks we are trying to solve. There can be more than one task per dataset, for example ones that include different sets of features, observations, or predict different target quantities.</p>
<p>Supervised learning can be further divided into regression (predicting numeric target values) and classification (predicting categorical target values/labels). In either case, the goal is to build a model that captures the relationship between features and target. We can build such models using machine learning algorithms, for example decision trees, support vector machines, neural networks, and many more. A machine learning algorithm, given training data, induces such a model. Machine learning algorithms are called “learners” in <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> (<a href="#sec-learners"><span>Section&nbsp;2.2</span></a>) – given data, they learn models. Each learner has a parameterized space that potential models are drawn from and during the training process, these parameters are fitted to best match the data. For example, the parameters could be the weights given to individual features when predicting a quantity in linear regression. For other learners, the parameters are not as explicit, for example for decision tree learners where a fitted model corresponds to a particular decision tree. All learners optimize a so-called loss function during training, i.e.&nbsp;training a learner means finding the model that optimizes the loss. In general, a loss function quantifies the mismatch between ground truth target values in the training data and the predictions of the model.</p>
<p>Given a model, we can make predictions (<a href="#sec-predicting"><span>Section&nbsp;2.2.2</span></a>) on new data. A model is only useful though if it generalizes beyond the training data. Otherwise, we could build a perfect model by simply memorizing the training data. Therefore, separate test data is used to evaluate models in an unbiased way and to assess to what extent they have learned the true relationships that underlie the data (<a href="performance.html"><span>Chapter&nbsp;3</span></a>). We can evaluate models in <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> in many ways (<a href="#sec-eval"><span>Section&nbsp;2.3</span></a>). In general, we use the same kind of loss function that the learner used to build the model, but now with data that was not used during training. The performance of a model, quantified by the value of the loss function when evaluated on new data, is called the estimated of the generalization error – how well do we expect this model to do in general? <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> calls loss functions “measures”. We can use different measures for training and testing, although it makes most sense for the measures to be the same.</p>
<p>Much more information on (supervised) machine learning can be found in <span class="citation" data-cites="hastie2001">Hastie, Friedman, and Tibshirani (<a href="references.html#ref-hastie2001" role="doc-biblioref">2001</a>)</span>, <span class="citation" data-cites="james_introduction_2014">James et al. (<a href="references.html#ref-james_introduction_2014" role="doc-biblioref">2014</a>)</span>, or <span class="citation" data-cites="bishop_2006">Bishop (<a href="references.html#ref-bishop_2006" role="doc-biblioref">2006</a>)</span>.</p>
<p>The basic idea is illustrated in the following figure:</p>
<div class="cell" data-layout-align="center" data-hash="basics_cache/html/fig-ml-abstraction_7fb6da6f3753d69242e49f4d804d2f27">
<div class="cell-output-display">
<div id="fig-ml-abstraction" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/ml_abstraction.svg" class="img-fluid figure-img" alt="A flowchart starting with the task (data), which splits into training- and test sets. The training set is used with the learner to fit a model, which is then used with the test set to make predictions. A performance measure is applied to the predictions and results in a performance estimate. Resampling refers to the repeated application of this process."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.1: General overview of the machine learning process.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="sec-tasks" class="level2 page-columns page-full" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="sec-tasks">
<span class="header-section-number">2.1</span> Tasks</h2>
<p>Tasks are objects that contain the (usually tabular) data and additional meta-data that define a machine learning problem. The meta-data contain, for example, the name of the target feature for supervised machine learning problems. This information is used automatically by operations that can be performed on a task so that for example the user does not have to specify the prediction target every time a model is trained.</p>
<section id="sec-tasks-built-in" class="level3" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="sec-tasks-built-in">
<span class="header-section-number">2.1.1</span> Built-in Tasks</h3>
<p><a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> includes a few predefined machine learning tasks in an R6 <code>Dictionary</code> named <a href="https://mlr3.mlr-org.com/reference/mlr_tasks.html"><code>mlr_tasks</code></a>.</p>
<div class="cell" data-hash="basics_cache/html/basics-001_bb2718bb83d960cd2dbaab76d87fa3e9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>mlr_tasks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DictionaryTask&gt; with 19 stored values
Keys: bike_sharing, boston_housing, breast_cancer, german_credit, ilpd,
  iris, kc_housing, moneyball, mtcars, optdigits, penguins,
  penguins_simple, pima, sonar, spam, titanic, usarrests, wine, zoo</code></pre>
</div>
</div>
<p>To get a task from the dictionary, use the <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>tsk()</code></a> function and assign the return value to a new variable. Here, we retrieve the <a href="https://mlr3.mlr-org.com/reference/mlr_tasks_mtcars.html"><code>mtcars regression task</code></a>, which is provided by the package datasets:</p>
<div class="cell" data-hash="basics_cache/html/basics-002_a25c731a92b2e4bf4c06ca69907785b0">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>task_mtcars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:mtcars&gt; (32 x 11): Motor Trends
* Target: mpg
* Properties: -
* Features (10):
  - dbl (10): am, carb, cyl, disp, drat, gear, hp, qsec, vs, wt</code></pre>
</div>
</div>
<p>To get more information about a particular task, it is easiest to use the <code><a href="https://rdrr.io/r/utils/help.html">help()</a></code> method that all <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a>-objects come with:</p>
<div class="cell" data-hash="basics_cache/html/basics-003_afb0090dc103499cc32c0d989095d460">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>task_mtcars<span class="sc">$</span><span class="fu">help</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are familiar with R’s help system (i.e.&nbsp;the <code><a href="https://rdrr.io/r/utils/help.html">help()</a></code> and <code>?</code> functions), this may seem confusing. <code>task_mtcars</code> is the variable that holds the mtcars task, not a function, and hence we cannot use <code><a href="https://rdrr.io/r/utils/help.html">help()</a></code> or <code>?</code>.</p>
</div>
</div>
<p>Alternatively, the corresponding man page can be found under <code>mlr_tasks_&lt;id&gt;</code>, e.g.</p>
<div class="cell" data-hash="basics_cache/html/basics-004_3f5aca8e24023e381e8056c50be30fcb">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">help</span>(<span class="st">"mlr_tasks_mtcars"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also load the data separately and convert it to a task, without using the <code>tsk()</code> function that <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> provides. If the data we want to use does not come with <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a>, it has to be done this way.</p>
<p>For example, the data for <a href="https://www.rdocumentation.org/packages/datasets/topics/mtcars"><code>mtcars</code></a> is also available separately, as a <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> and not a task. <a href="https://www.rdocumentation.org/packages/datasets/topics/mtcars"><code>mtcars</code></a> contains characteristics for different types of cars, along with their fuel consumption. We want to predict the numeric target feature stored in column <code>"mpg"</code> (miles per gallon).</p>
<div class="cell" data-hash="basics_cache/html/basics-006_6ddcfdfb2902bf0c24b05df6fd59889b">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>, <span class="at">package =</span> <span class="st">"datasets"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<p>We create the regression task, i.e.&nbsp;we construct a new instance of the R6 class <a href="https://mlr3.mlr-org.com/reference/TaskRegr.html"><code>TaskRegr</code></a>. An easy way to do this is to use the function <a href="https://mlr3.mlr-org.com/reference/as_task_regr.html"><code>as_task_regr()</code></a> to convert our <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> to a regression task, specifying the target feature in an additional argument. Before we give the data to <a href="https://mlr3.mlr-org.com/reference/as_task_regr.html"><code>as_task_regr()</code></a>, we can process it using the usual R functions, for example to select a subset of data.</p>
<div class="cell" data-hash="basics_cache/html/basics-007_189daeda7a9c66aa19b756b77a46dc47">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(<span class="st">"mlr3"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>mtcars_subset <span class="ot">=</span> <span class="fu">subset</span>(mtcars, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"cyl"</span>, <span class="st">"disp"</span>))</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>task_mtcars <span class="ot">=</span> <span class="fu">as_task_regr</span>(mtcars_subset, <span class="at">target =</span> <span class="st">"mpg"</span>, <span class="at">id =</span> <span class="st">"cars"</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a>task_mtcars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:cars&gt; (32 x 3)
* Target: mpg
* Properties: -
* Features (2):
  - dbl (2): cyl, disp</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The task constructors <a href="https://mlr3.mlr-org.com/reference/as_task_regr.html"><code>as_task_regr()</code></a> and <a href="https://mlr3.mlr-org.com/reference/as_task_classif.html"><code>as_task_classif()</code></a> will check for non-ASCII characters in the column names of your data. As many ML models do not work properly with arbitrary <a href="https://en.wikipedia.org/wiki/UTF-8">UTF8 names</a>, <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> defaults to throw an error if any of the column names contains either a non-ASCII character or does not comply with R’s variable naming scheme. We generally recommend converting names with <a href="https://www.rdocumentation.org/packages/base/topics/make.names"><code>make.names()</code></a> first, but you can also set the option <code>mlr3.allow_utf8_names</code> to true to relax the check (but do not be surprised if a model fails).</p>
</div>
</div>
<p>The data can be any rectangular data format, e.g.&nbsp;a <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>, <code>data.table()</code>, or <code>tibble()</code>. Internally, the data is converted and stored in a <a href="https://mlr3.mlr-org.com/reference/DataBackend.html"><code>DataBackend</code></a>. The <code>target</code> argument specifies the prediction target column. The <code>id</code> argument is optional and specifies an identifier for the task that is used in plots and summaries. If no <code>id</code> is given provided, the deparsed name of the data will be used (an R way of turning data into strings).</p>
<p>Printing a task gives a short summary: it has 32 observations and 3 columns, of which <code>mpg</code> is the target and 2 are features stored in double-precision floating point format.</p>
<p>We can plot the task using the <a href="https://mlr3viz.mlr-org.com"><code>mlr3viz</code></a> package, which gives a graphical summary of the distribution of the target and feature values:</p>
<div class="cell" data-hash="basics_cache/html/basics-008_4c4f902a27e736e20178f62f02f5e6e6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">autoplot</span>(task_mtcars, <span class="at">type =</span> <span class="st">"pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-008-1.png" class="img-fluid figure-img" alt="Diagram showing the distribution of target and feature values in the mtcars data." width="672"></p>
<p></p><figcaption class="figure-caption">Overview of the mtcars dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Instead of loading multiple extension packages individually, it is often more convenient to load the <a href="https://mlr3verse.mlr-org.com"><code>mlr3verse</code></a> package instead. It makes the functions from most <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> packages that are used for common machine learning and data science tasks available.</p>
</div>
</div>
</section><section id="sec-retrieve-data" class="level3" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="sec-retrieve-data">
<span class="header-section-number">2.1.2</span> Retrieving Data</h3>
<p>The <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> object primarily represents a tabular dataset, combined with meta-data about which columns of that data should be used to predict which other columns in what way, and some more information about column data types.</p>
<p>Various fields can be used to retrieve meta-data about a task. The dimensions, for example, can be retrieved using <code>$nrow</code> and <code>$ncol</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-009_fa8cc9403d70df498d60c09e49a7abb8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>task_mtcars<span class="sc">$</span>nrow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>task_mtcars<span class="sc">$</span>ncol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>The names of the feature and target columns are stored in the <code>$feature_names</code> and <code>$target_names</code> slots, respectively. Here, “target” refers to the feature we want to predict and “feature” to the predictors for the task.</p>
<div class="cell" data-hash="basics_cache/html/basics-010_65d95180a752be89f83091ceff0e033a">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>task_mtcars<span class="sc">$</span>feature_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cyl"  "disp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>task_mtcars<span class="sc">$</span>target_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mpg"</code></pre>
</div>
</div>
<p>While the columns of a task have unique <code>character</code>-valued names, their rows are identified by unique natural numbers, called row IDs. They can be accessed through the <code>$row_ids</code> slot:</p>
<div class="cell" data-hash="basics_cache/html/basics-011_3694799e435c1be2290d4fd53e5e549d">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">head</span>(task_mtcars<span class="sc">$</span>row_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5 6</code></pre>
</div>
</div>
<p>Row IDs are not used as features when predicting; they are meta-data that allows to access individual observations.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although the row IDs are typically just the sequence from <code>1</code> to <code>nrow(data)</code>, they are only guaranteed to be unique natural numbers. It is possible that they do not start at <code>1</code>, that they are not increasing by 1 each, or that they are not even in increasing order. This allows to transparently operate on real database management systems, where uniqueness is the only requirement for primary keys.</p>
</div>
</div>
<p>The data contained in a task can be accessed through <code>$data()</code>, which returns a <code>data.table</code> object. It has optional <code>rows</code> and <code>cols</code> arguments to specify subsets of the data to retrieve. When a database backend is used, this avoids loading unnecessary data into memory, making it more efficient than retrieving the entire data first and then subsetting it using <code>[&lt;rows&gt;, &lt;cols&gt;]</code>.</p>
<div class="cell" data-hash="basics_cache/html/basics-012_f1693860ce75b98f3782d883b4e4f5d7">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>task_mtcars<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg cyl  disp
 1: 21.0   6 160.0
 2: 21.0   6 160.0
 3: 22.8   4 108.0
 4: 21.4   6 258.0
 5: 18.7   8 360.0
---               
28: 30.4   4  95.1
29: 15.8   8 351.0
30: 19.7   6 145.0
31: 15.0   8 301.0
32: 21.4   4 121.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># retrieve data for rows with IDs 1, 5, and 10 and column "mpg"</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>task_mtcars<span class="sc">$</span><span class="fu">data</span>(<span class="at">rows =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">cols =</span> <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg
1: 21.0
2: 18.7
3: 19.2</code></pre>
</div>
</div>
<p>A shortcut to extract all data from a task is to simply convert it to a <code>data.table</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-013_848b3c4880cb4e50423c2eb52a6e52ad">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># show summary of all data</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">summary</span>(<span class="fu">as.data.table</span>(task_mtcars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             cyl             disp      
 Min.   :10.40   Min.   :4.000   Min.   : 71.1  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8  
 Median :19.20   Median :6.000   Median :196.3  
 Mean   :20.09   Mean   :6.188   Mean   :230.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0  </code></pre>
</div>
</div>
</section><section id="sec-tasks-mutators" class="level3" data-number="2.1.3"><h3 data-number="2.1.3" class="anchored" data-anchor-id="sec-tasks-mutators">
<span class="header-section-number">2.1.3</span> Task Mutators</h3>
<p>It is often necessary to create tasks that encompass subsets of other tasks’ data, for example to manually create <a href="#train-test-splits">train-test-splits</a>, or to fit models on a subset of given features. Restricting tasks to a given set of features can be done by calling <code>$select()</code> with the desired feature names. Restriction to rows (observations) is done with <code>$filter()</code> with the row IDs.</p>
<div class="cell" data-hash="basics_cache/html/basics-014_4bd0e09b06764eb33b65887433a0ac41">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>task_mtcars_small <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>) <span class="co"># initialize with the full task</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>task_mtcars_small<span class="sc">$</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"am"</span>, <span class="st">"carb"</span>)) <span class="co"># keep only these features</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>task_mtcars_small<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>) <span class="co"># keep only these rows</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg am carb
1: 21.0  1    4
2: 22.8  1    1
3: 21.4  0    1</code></pre>
</div>
</div>
<p>These methods are so-called <em>mutators</em>; they modify the given <code>Task</code> in place. If you want to have an unmodified version of the task, you need to use the <code>$clone()</code> method to create a copy first.</p>
<div class="cell" data-hash="basics_cache/html/basics-015_cab12b6a8831a5652c56cb884631bf2d">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>task_mtcars_smaller <span class="ot">=</span> task_mtcars_small<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb30-2"><a href="#cb30-2"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg am carb
1:  21  1    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()  <span class="co"># the original task is unmodified</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg am carb
1: 21.0  1    4
2: 22.8  1    1
3: 21.4  0    1</code></pre>
</div>
</div>
<p>Note also how the last call to <code>$filter(2)</code> did not select the second row of <code>task_mtcars_small</code>, but the row with ID 2, which is the <em>first</em> row of <code>task_mtcars_small</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you need to work with row numbers instead of row IDs, you can work on the vector of row IDs:</p>
<div class="cell" data-hash="basics_cache/html/basics-016_91af97f4c6a1b7078e8e6ac45c0ec79c">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># keep the 2nd row:</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>keep <span class="ot">=</span> task_mtcars_small<span class="sc">$</span>row_ids[<span class="dv">2</span>] <span class="co"># extracts ID of 2nd row</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">filter</span>(keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The methods above allow to subset the data; the methods <code>$rbind()</code> and <code>$cbind()</code> allow to add extra rows and columns to a task.</p>
<div class="cell" data-hash="basics_cache/html/basics-017_ac3249798a66594d8c2415fb280557aa">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">rbind</span>( <span class="co"># add another row</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">data.frame</span>(<span class="at">mpg =</span> <span class="dv">23</span>, <span class="at">am =</span> <span class="dv">0</span>, <span class="at">carb =</span> <span class="dv">3</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>)</span>
<span id="cb35-4"><a href="#cb35-4"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg am carb
1:  21  1    4
2:  23  0    3</code></pre>
</div>
</div>
</section><section id="sec-tasks-roles" class="level3 page-columns page-full" data-number="2.1.4"><h3 data-number="2.1.4" class="anchored" data-anchor-id="sec-tasks-roles">
<span class="header-section-number">2.1.4</span> Roles (Rows and Columns)</h3>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Some readers may want to skip this section of the book.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>We have seen that certain columns are designated as “targets” and “features” during task creation; <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> calls this “roles”. Target refers to the column(s) we want to predict and features are the predictors (also called co-variates or descriptors) for the target. Besides these two, there are other possible roles for columns. The roles affect the behavior of the task for different operations.</p>
<p>The <code>task_mtcars_small</code> task, for example, has the following column roles:</p>
<div class="cell" data-hash="basics_cache/html/basics-018_47cb15e72696fc360eeaa1eddb6535bb">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>task_mtcars_small<span class="sc">$</span>col_roles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$feature
[1] "am"   "carb"

$target
[1] "mpg"

$name
[1] "model"

$order
character(0)

$stratum
character(0)

$group
character(0)

$weight
character(0)</code></pre>
</div>
</div>
<p>As you can see, there are additional column roles; the interested reader is referred to the documentation of <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> for more detail. We can list all supported column roles by printing the names of the field <code>$col_roles</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-019_e46137e38662a3c37fa40ea918856868">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># supported column roles, see ?Task</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="fu">names</span>(task_mtcars_small<span class="sc">$</span>col_roles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "feature" "target"  "name"    "order"   "stratum" "group"   "weight" </code></pre>
</div>
</div>
<p>Columns can have multiple roles. It is also possible for a column to have no role at all, in which case they are ignored. This is, in fact, how <code>$select()</code> and <code>$filter()</code> operate: They unassign the <code>"feature"</code> (for columns) or <code>"use"</code> (for rows) role without modifying the data which is stored in an immutable backend:</p>
<div class="cell" data-hash="basics_cache/html/basics-020_2b1f32f51bf5d3e734e5a7a3f7d630b5">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>task_mtcars_small<span class="sc">$</span>backend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DataBackendDataTable&gt; (32x13)
             model  mpg cyl disp  hp drat    wt  qsec vs am gear carb ..row_id
         Mazda RX4 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4        1
     Mazda RX4 Wag 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4        2
        Datsun 710 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1        3
    Hornet 4 Drive 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1        4
 Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2        5
           Valiant 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1        6
[...] (26 rows omitted)</code></pre>
</div>
</div>
<p>There are two main ways to manipulate the column roles of a <code>Task</code>:</p>
<ol type="1">
<li>Use the <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> method <code>$set_col_roles()</code> (recommended).</li>
<li>Directly modify the field <code>$col_roles</code>, which is a named list of vectors of column names. Each vector in this list corresponds to a column role, and the column names contained in that vector have the corresponding role.</li>
</ol>
<p>Just as <code>$select()</code>/<code>$filter()</code>, these are in-place operations, i.e.&nbsp;the task object itself is modified. To retain an unmodified version of a task, use <code>$clone()</code>.</p>
<p>Changing the column or row roles, whether through <code>$select()</code>/<code>$filter()</code> or directly, does not change the underlying data, it just updates the view on it. Because the underlying data are still there (and accessible through <code>$backend</code>), we can add the <code>"cyl"</code> column back into the task by setting its column role to <code>"feature"</code>.</p>
<div class="cell" data-hash="basics_cache/html/basics-021_9408dc39090504f507060f91e1bcfa42">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">set_col_roles</span>(<span class="st">"cyl"</span>, <span class="at">roles =</span> <span class="st">"feature"</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a>task_mtcars_small<span class="sc">$</span>feature_names  <span class="co"># cyl is now a feature again</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "am"   "carb" "cyl" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg am carb cyl
1: 21.0  1    4   6
2: 22.8  1    1   4
3: 21.4  0    1   6</code></pre>
</div>
</div>
<p>Just like columns, it is also possible to assign different roles to rows. Rows can have two different roles:</p>
<ol type="1">
<li>Role <code>use</code>: Rows that are generally available for training (although they may also be used for the test set). This role is the default role. The <code>$filter()</code> call changes this role, in the same way that <code>$select()</code> changes the <code>"feature"</code> column role.</li>
<li>Role <code>validation</code>: Rows that are not used for training. Rows that have missing values in the target column during task creation are automatically set to the validation role.</li>
</ol>
<p>There are several reasons to hold some observations back or treat them differently:</p>
<ol type="1">
<li>It is often good practice to validate the final model on an external validation set to identify overfitting.</li>
<li>Some observations may be unlabeled in the original data, e.g.&nbsp;in competitions like <a href="https://www.kaggle.com/">Kaggle</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ol>
<div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;<a href="https://www.kaggle.com/">https://www.kaggle.com/</a></p></li></div><p>These observations cannot be used for training a model, but can be used for getting predictions from a trained model.</p>
</section></section><section id="sec-learners" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="sec-learners">
<span class="header-section-number">2.2</span> Learners</h2>
<p>Objects of class <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> provide a unified interface to many popular machine learning algorithms in R. They are available through the <code>mlr_learners</code> dictionary. The list of learners supported in the base package <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> is deliberately small to avoid dependencies; support for additional learners is provided by the <a href="https://mlr3learners.mlr-org.com"><code>mlr3learners</code></a> and <a href="https://mlr3extralearners.mlr-org.com"><code>mlr3extralearners</code></a> packages.</p>
<p>Learners encapsulate methods to train a model and make predictions using it given a <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> and provide meta-data about the learners. The base class of each learner is <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a>.</p>
<p>To retrieve a <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> from the <code>mlr_learners</code> dictionary, use the function <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrn()</code></a>:</p>
<div class="cell" data-hash="basics_cache/html/basics-023_0979c26bcc6c0010c4acb7f15854925a">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each learner provides the following meta-data:</p>
<ul>
<li>
<code>$feature_types</code>: the type of features the learner can deal with.</li>
<li>
<code>$packages</code>: the packages required to train a model with this learner and make predictions.</li>
<li>
<code>$properties</code>: additional properties and capabilities. For example, a learner has the property “missings” if it is able to handle missing feature values, and “importance” if it computes and allows to extract data on the relative importance of the features.</li>
<li>
<code>$predict_types</code>: possible prediction types. For example, a regression learner can predict numerical values (“response”) and may be able to predict the standard error of a prediction (“se”).</li>
</ul>
<p>This information can be queried through these slots, or seen at a glance when printing the learner:</p>
<div class="cell" data-hash="basics_cache/html/basics-024_597e1dd8f2a2f7f8633f33f841e39209">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>learner_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerRegrRpart:regr.rpart&gt;: Regression Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, selected_features, weights</code></pre>
</div>
</div>
<p>All learners work in two stages:</p>
<ul>
<li>
<strong>Training</strong>: A training task (features and target data) is passed to the learner’s <code>$train()</code> function which trains and stores a model, i.e.&nbsp;the learned relationship of the features to the target.</li>
<li>
<strong>Prediction</strong>: New data, usually a different partition of the original dataset, is passed to the <code>$predict()</code> method of the trained learner. The model trained in the first step is used to predict the target values, e.g.&nbsp;the numerical value for regression problems.</li>
</ul>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>A learner that has not been trained cannot make predictions and will throw an error if <code>$predict()</code> is called on it.</p>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="basics_cache/html/fig-basics-learner_b78bb3f512e7e66ea83ce204b88818c0">
<div class="cell-output-display">
<div id="fig-basics-learner" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/learner.svg" class="img-fluid figure-img" alt="Diagram showing the different stages of a learner, their interactions, and consumed data."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.2: Overview of the different stages of a learner.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="sec-training" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-training">
<span class="header-section-number">2.2.1</span> Training the learner</h3>
<p>We train the model by giving a task to the learner. It is a good idea to hold back some data from the training process use to assess the quality of the predictions made by the trained model. The <a href="https://mlr3.mlr-org.com/reference/partition.html"><code>partition()</code></a> function randomly splits the task into two disjoint sets: a training set (67% of the total data, the default) and a test set (33% of the total data, the data not part of the training set).</p>
<div class="cell" data-hash="basics_cache/html/basics-025_267bc9fa489b18a7ca61653f3724c23d">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_mtcars)</span>
<span id="cb50-2"><a href="#cb50-2"></a>splits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$train
 [1]  1  2  3  4  5  8 25 30 32  6 11 13 17 22 23 24 29 31 19 20 28

$test
 [1]  9 10 21 27  7 12 14 15 16 18 26</code></pre>
</div>
</div>
<p>We learn a regression tree by calling the <code>$train()</code> method of the learner, specifying the task and the part of it to use for training (<code>splits$train</code>). This operation adds the learned model to the existing <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> object. We can now access the stored model via the field <code>$model</code>.</p>
<div class="cell" data-hash="basics_cache/html/basics-025-1_a7b2ae1b86f2f2b5b5a015811f0a09e3">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb52-2"><a href="#cb52-2"></a>learner_rpart<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 21 

node), split, n, deviance, yval
      * denotes terminal node

1) root 21 617.38670 20.33333  
  2) disp&gt;=153.35 14  88.36857 17.42857 *
  3) disp&lt; 153.35 7 174.63710 26.14286 *</code></pre>
</div>
</div>
<p>We see that the learner has identified features in the task that are predictive of the class (<code>mpg</code>) and uses them to partition observations in the tree. The textual representation of the model depends on the type of learner. For more information on this particular type of model and how it is printed, see <a href="https://www.rdocumentation.org/packages/rpart/topics/print.rpart"><code>rpart::print.rpart()</code></a>.</p>
<p>The model seems rather simplistic, using only a single feature and a single set of branches. Each learner has hyperparameters that control its behavior and allow to influence the way a model is learned. Setting hyperparameters to values appropriate for a given machine learning task is crucial for good predictive performance. The field <code>param_set</code> stores a description of the hyperparameters the learner has, their ranges, defaults, and current values:</p>
<div class="cell" data-hash="basics_cache/html/basics-026_33e174c338d15f0596ba15ae5ec598eb">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>learner_rpart<span class="sc">$</span>param_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ParamSet&gt;
                id    class lower upper nlevels        default value
 1:             cp ParamDbl     0     1     Inf           0.01      
 2:     keep_model ParamLgl    NA    NA       2          FALSE      
 3:     maxcompete ParamInt     0   Inf     Inf              4      
 4:       maxdepth ParamInt     1    30      30             30      
 5:   maxsurrogate ParamInt     0   Inf     Inf              5      
 6:      minbucket ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;      
 7:       minsplit ParamInt     1   Inf     Inf             20      
 8: surrogatestyle ParamInt     0     1       2              0      
 9:   usesurrogate ParamInt     0     2       3              2      
10:           xval ParamInt     0   Inf     Inf             10     0</code></pre>
</div>
</div>
<p>The set of current hyperparameter values is stored in the <code>values</code> field of the <code>param_set</code> field. You can access and change the current hyperparameter values by accessing this field, which stores a named list:</p>
<div class="cell" data-hash="basics_cache/html/basics-027_6af23f0216f0731084d1c5e22fba2c01">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>minsplit <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$minsplit
[1] 10</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is possible to assign all hyperparameters in one go by assigning a named list to <code>$values</code>: <code>learner$param_set$values = list(minsplit = 10, ...)</code>. This operation removes all previously-set hyperparameters.</p>
</div>
</div>
<p>The <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrn()</code></a> function also accepts additional arguments to update hyperparameters or set fields of the learner when constructing it:</p>
<div class="cell" data-hash="basics_cache/html/basics-028_d6136dd6776137df6327d3b5f44fa7da">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb60-2"><a href="#cb60-2"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$minsplit
[1] 10</code></pre>
</div>
</div>
<div class="cell" data-hash="basics_cache/html/basics-029_6950be7a1dda02afabd3f792abb4d22b">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb62-2"><a href="#cb62-2"></a>learner_rpart<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 21 

node), split, n, deviance, yval
      * denotes terminal node

1) root 21 617.386700 20.33333  
  2) disp&gt;=101.55 18 167.562800 18.46111  
    4) cyl&gt;=7 9  30.075560 16.07778 *
    5) cyl&lt; 7 9  35.242220 20.84444 *
  3) disp&lt; 101.55 3   8.166667 31.56667 *</code></pre>
</div>
</div>
<p>With the changed hyperparameters, we have a more complex (and more reasonable) model.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Details on the hyperparameters of our <code>rpart</code> learner can be found at <a href="https://www.rdocumentation.org/packages/rpart/topics/rpart.control"><code>rpart::rpart.control()</code></a>. Hyperparameters in general are discussed in more detail in the section on <a href="#tuning">Hyperparameter Tuning</a>.</p>
</div>
</div>
</section><section id="sec-predicting" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-predicting">
<span class="header-section-number">2.2.2</span> Predicting</h3>
<p>After the model has been created, we can now use it to make predictions. We can give the test partition to the <code>$predict()</code> function:</p>
<div class="cell" data-hash="basics_cache/html/basics-030_bf1e9f02226c9ff4fbf27d54f76af0dd">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb64-2"><a href="#cb64-2"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response
          9  22.8 20.84444
         10  19.2 20.84444
         21  21.5 20.84444
---                       
         16  10.4 16.07778
         18  32.4 31.56667
         26  27.3 31.56667</code></pre>
</div>
</div>
<p>The <code>$predict()</code> method returns a <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> object, in this case a <a href="https://mlr3.mlr-org.com/reference/PredictionRegr.html"><code>PredictionRegr</code></a> for predicting a numeric quantity. The “truth” column contains the ground truth data, which was not given to the model to get a prediction. The “response” column contains the value predicted by the model, allowing for easy comparison with the ground truth data.</p>
<p>We can also use separate data to make predictions, which can be part of a separate task or simply a separate <code>data.frame</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-031_a5fd161dced9806451577e21103952f7">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>mtcars_new <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">cyl =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb66-2"><a href="#cb66-2"></a>                        <span class="at">disp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb66-3"><a href="#cb66-3"></a>                        <span class="at">hp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>),</span>
<span id="cb66-4"><a href="#cb66-4"></a>                        <span class="at">drat =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">3.9</span>),</span>
<span id="cb66-5"><a href="#cb66-5"></a>                        <span class="at">wt =</span> <span class="fu">c</span>(<span class="fl">3.8</span>, <span class="fl">4.1</span>),</span>
<span id="cb66-6"><a href="#cb66-6"></a>                        <span class="at">qsec =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="fl">19.5</span>),</span>
<span id="cb66-7"><a href="#cb66-7"></a>                        <span class="at">vs =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb66-8"><a href="#cb66-8"></a>                        <span class="at">am =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb66-9"><a href="#cb66-9"></a>                        <span class="at">gear =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">4</span>),</span>
<span id="cb66-10"><a href="#cb66-10"></a>                        <span class="at">carb =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb66-11"><a href="#cb66-11"></a>mtcars_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl disp  hp drat  wt qsec vs am gear carb
1   5  100 100  4.0 3.8 18.0  1  1    6    3
2   6  120 150  3.9 4.1 19.5  0  1    4    5</code></pre>
</div>
</div>
<p>The learner does not need to know more meta-data about this data to make predictions, as this was given when training the model. We can use the <code>$predict_newdata()</code> method to make predictions for our separate dataset:</p>
<div class="cell" data-hash="basics_cache/html/basics-032_53ad0d8a1bc0de1e54ec6f4a22f3e458">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict_newdata</span>(mtcars_new)</span>
<span id="cb68-2"><a href="#cb68-2"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 2 observations:
 row_ids truth response
       1    NA 31.56667
       2    NA 20.84444</code></pre>
</div>
</div>
<p>Note that the “truth” column is now <code>NA</code>, as we did not give the ground truth data.</p>
<p>We can also access the predictions directly:</p>
<div class="cell" data-hash="basics_cache/html/basics-access-pred_5fd2a7341cd0f3110ba3bc9f4871b058">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>predictions<span class="sc">$</span>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.56667 20.84444</code></pre>
</div>
</div>
<p>Similar to plotting tasks, <a href="https://mlr3viz.mlr-org.com"><code>mlr3viz</code></a> provides an <a href="https://www.rdocumentation.org/packages/ggplot2/topics/autoplot"><code>autoplot()</code></a> method for <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> objects.</p>
<div class="cell" data-hash="basics_cache/html/basics-035_67808f78ce67db56a2ebe678eafeff54">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb72-2"><a href="#cb72-2"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="fu">autoplot</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-035-1.png" class="img-fluid figure-img" alt="A scatter plot of predicted values on one axis and ground truth values on the other. A trend line is fit to show that in general there is good agreement between predicted and ground truth values." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the mtcars dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-predict-type" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-predict-type">
<span class="header-section-number">2.2.3</span> Changing the Prediction Type</h3>
<p>Regression learners default to predicting a numeric quantity. However, many regression models can also give you bounds on the prediction by providing the standard error. To predict these standard errors, the <code>predict_type</code> field of a <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html"><code>LearnerRegr</code></a> must be changed from “response” (the default) to “se” before training. The <code>rpart</code> learner we used above does not support predicting standard errors, so we use the <code>lm</code> linear model instead, from the <a href="https://mlr3learners.mlr-org.com/reference/mlr3learners-package.html"><code>mlr3learners</code></a> package:</p>
<div class="cell" data-hash="basics_cache/html/basics-033_1139c5f281fea1f7382333efa056f63b">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a>learner_lm <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.lm"</span>)</span>
<span id="cb73-4"><a href="#cb73-4"></a>learner_lm<span class="sc">$</span>predict_type <span class="ot">=</span> <span class="st">"se"</span></span>
<span id="cb73-5"><a href="#cb73-5"></a>learner_lm<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb73-6"><a href="#cb73-6"></a>predictions <span class="ot">=</span> learner_lm<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb73-7"><a href="#cb73-7"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response        se
          9  22.8 26.35691 1.4217357
         10  19.2 21.30664 0.9926847
         21  21.5 26.44570 1.2694455
---                                 
         16  10.4 15.11714 2.1783078
         18  32.4 26.62327 1.1895495
         26  27.3 26.62199 1.1888914</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#sec-lrns-add-list"><span>Section&nbsp;2.6.1</span></a> shows how to list learners that support the standard error prediction type.</p>
</div>
</div>
<p>The prediction object now contains the standard error for the predictions.</p>
<div class="cell" data-hash="basics_cache/html/basics-034_49002f93a694c969406c9d7c0e87d343">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response        se
          9  22.8 26.35691 1.4217357
         10  19.2 21.30664 0.9926847
         21  21.5 26.44570 1.2694455
---                                 
         16  10.4 15.11714 2.1783078
         18  32.4 26.62327 1.1895495
         26  27.3 26.62199 1.1888914</code></pre>
</div>
</div>
</section></section><section id="sec-eval" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="sec-eval">
<span class="header-section-number">2.3</span> Evaluation</h2>
<p>An important step of modeling is evaluating the performance of the trained model. We have seen how to inspect the model and plot its predictions above, but a more rigorous way that allows to compare different types of models more easily is to compute a performance measure. <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> offers many performance measures, which can be created with the <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>msr()</code></a> function. Measures are stored in the dictionary <a href="https://mlr3.mlr-org.com/reference/mlr_measures.html"><code>mlr_measures</code></a>, and a measure has to be supported by <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> to be used, just like learners. For example, we can list all measures that are available for regression tasks:</p>
<div class="cell" data-hash="basics_cache/html/basics-036_2a18cbba24e316a7604e2776ae7ae813">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>mlr_measures<span class="sc">$</span><span class="fu">keys</span>(<span class="st">"regr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "regr.bias"  "regr.ktau"  "regr.mae"   "regr.mape"  "regr.maxae"
 [6] "regr.medae" "regr.medse" "regr.mse"   "regr.msle"  "regr.pbias"
[11] "regr.rae"   "regr.rmse"  "regr.rmsle" "regr.rrse"  "regr.rse"  
[16] "regr.rsq"   "regr.sae"   "regr.smape" "regr.srho"  "regr.sse"  </code></pre>
</div>
</div>
<p>Measure objects can be created with a single performance measure (<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>msr()</code></a>) or multiple (<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>msrs()</code></a>):</p>
<div class="cell" data-hash="basics_cache/html/basics-037_15ca89bea28b01955a1e416f9efb2a0e">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.rmse"</span>)</span>
<span id="cb79-2"><a href="#cb79-2"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.rmse"</span>, <span class="st">"regr.sse"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the core of all performance measures is a quantification of the difference between the predicted value and the ground truth value (except for unsupervised tasks, which we will discuss later). This means that in order to assess performance, we usually need the ground truth data – observations for which we do not know the true value cannot be used to assess the quality of the predictions of a model. This is why we make predictions on the data the model did not use during training (the test set).</p>
<p>As we have seen above, <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a>’s <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> objects contain both predictions and ground truth. The <a href="https://mlr3.mlr-org.com/reference/Measure.html"><code>Measure</code></a> objects define how prediction and ground truth are compared, and how differences between them are quantified. We choose root mean squared error (<a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.rmse.html"><code>regr.rmse</code></a>) as our performance measure for this example. Once the measure is created, we can pass it to the <code>$score()</code> method of the <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> object to quantify the predictive performance of our model.</p>
<div class="cell" data-hash="basics_cache/html/basics-038_a96663728c1c0583019204af1b8b9b26">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.rmse"</span>)</span>
<span id="cb80-2"><a href="#cb80-2"></a>measure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;MeasureRegrSimple:regr.rmse&gt;: Root Mean Squared Error
* Packages: mlr3, mlr3measures
* Range: [0, Inf]
* Minimize: TRUE
* Average: macro
* Parameters: list()
* Properties: -
* Predict type: response</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.rmse 
 3.328844 </code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>$score()</code> can be called without a measure; in this case the default measure for the type of task is used. Regression defaults to mean squared error (<a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.mse.html"><code>regr.mse</code></a>).</p>
</div>
</div>
<p>It is possible to calculate multiple measures at the same time by passing multiple measures to <code>$score()</code>. For example, to compute both root mean squared error <a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.rmse.html"><code>regr.rmse</code></a> and mean squared error <a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.mse.html"><code>regr.mse</code></a>:</p>
<div class="cell" data-hash="basics_cache/html/basics-039_343a7ac6fb01039580b246f686bcf74f">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.rmse"</span>, <span class="st">"regr.mse"</span>))</span>
<span id="cb84-2"><a href="#cb84-2"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.rmse  regr.mse 
 3.328844 11.081203 </code></pre>
</div>
</div>
<p><a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> also provides measures that do not quantify the quality of the predictions of a model, but other information we may be interested in, for example the time it took to train the model and make predictions:</p>
<div class="cell" data-hash="basics_cache/html/basics-measures-time_9c78d520c98ffff51f3b609cbc88a739">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"time_train"</span>, <span class="st">"time_predict"</span>))</span>
<span id="cb86-2"><a href="#cb86-2"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measures, <span class="at">learner =</span> learner_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time_train time_predict 
       0.003        0.003 </code></pre>
</div>
</div>
<p>Note that these measures require a trained learner in addition to the predictions.</p>
<p>Some measures have hyperparameters themselves, for example <a href="https://mlr3.mlr-org.com/reference/mlr_measures_selected_features.html"><code>selected_features</code></a>. This measure gives information on the features the model used and is only supported by learners that have the “selected_features” property. It requires a task and a learner in addition to the predictions. The <code>lm</code> model does not support showing selected features; we use the <code>rpart</code> learner again and the full <code>mtcars</code> task.</p>
<div class="cell" data-hash="basics_cache/html/basics-measures-hp_cbdaa89da4d75b12b7f8880790409866">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_mtcars)</span>
<span id="cb88-3"><a href="#cb88-3"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb88-4"><a href="#cb88-4"></a></span>
<span id="cb88-5"><a href="#cb88-5"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb88-6"><a href="#cb88-6"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb88-7"><a href="#cb88-7"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>)</span>
<span id="cb88-8"><a href="#cb88-8"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure, <span class="at">task =</span> task_mtcars, <span class="at">learner =</span> learner_rpart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>selected_features 
                2 </code></pre>
</div>
</div>
<p>The hyperparameter of the measure specifies whether the number of selected features should be normalized by the total number of features. The default is <code>FALSE</code>, giving the absolute number of features that, in this case, the trained decision tree uses. We can change the hyperparameter in the same way as for learners, for example:</p>
<div class="cell" data-hash="basics_cache/html/basics-measures-hp-set_7a6c283986f507133c5fbf5e5a708532">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>, <span class="at">normalize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-2"><a href="#cb90-2"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure, <span class="at">task =</span> task_mtcars, <span class="at">learner =</span> learner_rpart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>selected_features 
              0.2 </code></pre>
</div>
</div>
<p>We have now seen the basic building blocks of <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> – creating and partitioning a task, instantiating a learner and setting its hyperparameters, training a model and inspecting it, making predictions, and assessing the quality of the model with a performance measure. So far, we have focused on regression, where we want to predict a numeric quantity. The rest of this chapter looks at other task types. The general procedure it the same, but some details are different.</p>
</section><section id="sec-classif" class="level2 page-columns page-full" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="sec-classif">
<span class="header-section-number">2.4</span> Classification</h2>
<p>Classification predicts a discrete, categorical target instead of the continuous numeric quantity for regression. The models that learn to classify data are different from regression models, and regression learners are not applicable for classification problems (although for some learners, there are both regression and classification versions). <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> distinguishes between the different tasks and learner types through different R6 classes and different prefixes – regression learners and measures start with <code>regr.</code>, whereas classification learners and measures start with <code>classif.</code>.</p>
<section id="sec-classif-tsks" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="sec-classif-tsks">
<span class="header-section-number">2.4.1</span> Classification Tasks</h3>
<p>The <a href="https://mlr3.mlr-org.com/reference/mlr_tasks.html"><code>mlr_tasks</code></a> dictionary that comes with <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> contains several classification tasks (<a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>TaskClassif</code></a>). We can show only the classification tasks by converting the dictionary to a <code>data.table</code> and filtering on the <code>task_type</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-040_d5dd50c1f16444ca2abf170d54da3cad">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="fu">as.data.table</span>(mlr_tasks)[task_type <span class="sc">==</span> <span class="st">"classif"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                key                                     label task_type nrow
 1:   breast_cancer                   Wisconsin Breast Cancer   classif  683
 2:   german_credit                             German Credit   classif 1000
 3:            ilpd                 Indian Liver Patient Data   classif  583
 4:            iris                              Iris Flowers   classif  150
 5:       optdigits Optical Recognition of Handwritten Digits   classif 5620
 6:        penguins                           Palmer Penguins   classif  344
 7: penguins_simple                Simplified Palmer Penguins   classif  333
 8:            pima                      Pima Indian Diabetes   classif  768
 9:           sonar                    Sonar: Mines vs. Rocks   classif  208
10:            spam                         HP Spam Detection   classif 4601
11:         titanic                                   Titanic   classif 1309
12:            wine                              Wine Regions   classif  178
13:             zoo                               Zoo Animals   classif  101
9 variables not shown: [ncol, properties, lgl, int, dbl, chr, fct, ord, pxc]</code></pre>
</div>
</div>
<p>We will use the <a href="https://www.rdocumentation.org/packages/datasets/topics/penguins"><code>penguins</code></a> dataset as a running example:</p>
<div class="cell" data-hash="basics_cache/html/basics-041_1faddf22fe20637086472e40b419b898">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>task_penguins <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>)</span>
<span id="cb94-2"><a href="#cb94-2"></a>task_penguins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:penguins&gt; (344 x 8): Palmer Penguins
* Target: species
* Properties: multiclass
* Features (7):
  - int (3): body_mass, flipper_length, year
  - dbl (2): bill_depth, bill_length
  - fct (2): island, sex</code></pre>
</div>
</div>
<p>Just like for regression tasks, printing it gives an overview of the task, including the number of observations and features, and their types.</p>
<p>The target variable, species, is of type factor and has the following three classes or levels:</p>
<div class="cell" data-hash="basics_cache/html/basics-042_169b97e9348dcaa3f562f67bb124ea1e">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="fu">unique</span>(task_penguins<span class="sc">$</span><span class="fu">data</span>(<span class="at">cols =</span> <span class="st">"species"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     species
1:    Adelie
2:    Gentoo
3: Chinstrap</code></pre>
</div>
</div>
<p>Classification tasks (<a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>TaskClassif</code></a>) can also be plotted using <a href="https://www.rdocumentation.org/packages/ggplot2/topics/autoplot"><code>autoplot()</code></a>. Apart from the “pairs” plot type that we show here, “target” and “duo” are available. We refer the interested reader to the documentation of <a href="https://mlr3viz.mlr-org.com/reference/autoplot.TaskClassif.html"><code>mlr3viz::autoplot.TaskClassif</code></a> for an explanation of the other options. To keep the plot readable, we select only the first two features of the dataset.</p>
<div class="cell" data-hash="basics_cache/html/basics-043_f7be92956d55d8a549f46ff8eaac7b95">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb98-2"><a href="#cb98-2"></a></span>
<span id="cb98-3"><a href="#cb98-3"></a>task_penguins_small <span class="ot">=</span> task_penguins<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb98-4"><a href="#cb98-4"></a>task_penguins_small<span class="sc">$</span><span class="fu">select</span>(<span class="fu">head</span>(task_penguins_small<span class="sc">$</span>feature_names, <span class="dv">2</span>))</span>
<span id="cb98-5"><a href="#cb98-5"></a><span class="fu">autoplot</span>(task_penguins_small, <span class="at">type =</span> <span class="st">"pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-043-1.png" class="img-fluid figure-img" alt="Diagram showing the distribution of target and feature values in the penguins data." width="672"></p>
<p></p><figcaption class="figure-caption">Overview of the penguins dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-classif-lrns" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="sec-classif-lrns">
<span class="header-section-number">2.4.2</span> Classification Learners</h3>
<p>Classification learners (<a href="https://mlr3.mlr-org.com/reference/LearnerClassif.html"><code>LearnerClassif</code></a>) are a different R6 class than regression learners (<a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html"><code>LearnerRegr</code></a>), but also inherit from the base class <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a>. We can instantiate a classification learner in the same way as a regression learner, by retrieving it from the <code>mlr_learners</code> dictionary using <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrn()</code></a>. Note the <code>classif.</code> prefix to denote that we want a learner that classifies observations:</p>
<div class="cell" data-hash="basics_cache/html/basics-044_f8adf3cce8a764f00eb856533ac0fc2f">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb99-2"><a href="#cb99-2"></a>learner_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifRpart:classif.rpart&gt;: Classification Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response], prob
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, multiclass, selected_features,
  twoclass, weights</code></pre>
</div>
</div>
<p>Just like regression learners, classification learners have hyperparameters we can set to change their behavior, and printing the learner object gives some basic information about it. Training a model and making predictions works in the same way as for regression:</p>
<div class="cell" data-hash="basics_cache/html/basics-classification-train-predict_5f89a3485bf9e18eb6a0330e88db990f">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_penguins)</span>
<span id="cb101-2"><a href="#cb101-2"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb101-3"><a href="#cb101-3"></a>learner_rpart<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 231 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

1) root 231 129 Adelie (0.441558442 0.199134199 0.359307359)  
  2) flipper_length&lt; 206.5 143  43 Adelie (0.699300699 0.293706294 0.006993007)  
    4) bill_length&lt; 44.2 101   3 Adelie (0.970297030 0.029702970 0.000000000) *
    5) bill_length&gt;=44.2 42   3 Chinstrap (0.047619048 0.928571429 0.023809524) *
  3) flipper_length&gt;=206.5 88   6 Gentoo (0.022727273 0.045454545 0.931818182)  
    6) bill_depth&gt;=17.2 7   3 Chinstrap (0.285714286 0.571428571 0.142857143) *
    7) bill_depth&lt; 17.2 81   0 Gentoo (0.000000000 0.000000000 1.000000000) *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_penguins, splits<span class="sc">$</span>test)</span>
<span id="cb103-2"><a href="#cb103-2"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 113 observations:
    row_ids     truth  response
          2    Adelie    Adelie
          3    Adelie    Adelie
         10    Adelie    Adelie
---                            
        332 Chinstrap Chinstrap
        335 Chinstrap Chinstrap
        341 Chinstrap    Adelie</code></pre>
</div>
</div>
<p>Just like predictions of regression models, we can plot classification predictions with <a href="https://www.rdocumentation.org/packages/ggplot2/topics/autoplot"><code>autoplot()</code></a>:</p>
<div class="cell" data-hash="basics_cache/html/basics-plot-pred-classif_ebcc049d40c6b9572ab7adb30dfcd1ab">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="fu">autoplot</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-plot-pred-classif-1.png" class="img-fluid figure-img" alt="A stacked bar plot of predicted values in one bar and ground truth values in the other. The number of observations for a particular class is approximately, but not quite, the same for predicted and ground truth values." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the penguins dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="sec-classif-pred_type" class="level4" data-number="2.4.2.1"><h4 data-number="2.4.2.1" class="anchored" data-anchor-id="sec-classif-pred_type">
<span class="header-section-number">2.4.2.1</span> Changing the Prediction Type</h4>
<p>Classification problems support two types of predictions: the default “response”, i.e.&nbsp;the class label, and “prob”, which gives the probability for each class label. Not all learners support predicting probabilities.</p>
<p>The prediction type for a learner can be changed by setting <code>$predict_type</code>. After retraining the learner, all predictions have class probabilities (one for each class) in addition to the response, which is the class with the highest probability:</p>
<div class="cell" data-hash="basics_cache/html/basics-046_5e02604fdb399fbe240354d9a95c12b4">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>learner_rpart<span class="sc">$</span>predict_type <span class="ot">=</span> <span class="st">"prob"</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb106-3"><a href="#cb106-3"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_penguins, splits<span class="sc">$</span>test)</span>
<span id="cb106-4"><a href="#cb106-4"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 113 observations:
    row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
          2    Adelie    Adelie  0.97029703     0.02970297  0.00000000
          3    Adelie    Adelie  0.97029703     0.02970297  0.00000000
         10    Adelie    Adelie  0.97029703     0.02970297  0.00000000
---                                                                   
        332 Chinstrap Chinstrap  0.04761905     0.92857143  0.02380952
        335 Chinstrap Chinstrap  0.04761905     0.92857143  0.02380952
        341 Chinstrap    Adelie  0.97029703     0.02970297  0.00000000</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#sec-lrns-add-list"><span>Section&nbsp;2.6.1</span></a> shows how to list learners that support the probability prediction type.</p>
</div>
</div>
</section></section><section id="sec-classif-eval" class="level3 page-columns page-full" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="sec-classif-eval">
<span class="header-section-number">2.4.3</span> Classification Evaluation</h3>
<p>Evaluation measures for classification problems that are supported by <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> can be found in the <code>mlr_measures</code> dictionary:</p>
<div class="cell" data-hash="basics_cache/html/basics-047_742451e8f68fd0d644fed3d6efbcb9f6">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>mlr_measures<span class="sc">$</span><span class="fu">keys</span>(<span class="st">"classif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "classif.acc"         "classif.auc"         "classif.bacc"       
 [4] "classif.bbrier"      "classif.ce"          "classif.costs"      
 [7] "classif.dor"         "classif.fbeta"       "classif.fdr"        
[10] "classif.fn"          "classif.fnr"         "classif.fomr"       
[13] "classif.fp"          "classif.fpr"         "classif.logloss"    
[16] "classif.mauc_au1p"   "classif.mauc_au1u"   "classif.mauc_aunp"  
[19] "classif.mauc_aunu"   "classif.mbrier"      "classif.mcc"        
[22] "classif.npv"         "classif.ppv"         "classif.prauc"      
[25] "classif.precision"   "classif.recall"      "classif.sensitivity"
[28] "classif.specificity" "classif.tn"          "classif.tnr"        
[31] "classif.tp"          "classif.tpr"        </code></pre>
</div>
</div>
<p>Some of these measures require the <a href="#sec-classif-pred_type">predictition type</a> to be “prob” (e.g.&nbsp;<code>classif.auc</code>). As the default is “response”, using those measures requires to change the prediction type, as shown above. You can check what prediction type a measure requires by looking at <code>$predict_type</code>.</p>
<div class="cell" data-hash="basics_cache/html/basics-048_4e39d070affba482ca39eaa30ca809ef">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span>
<span id="cb110-2"><a href="#cb110-2"></a>measure<span class="sc">$</span>predict_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "response"</code></pre>
</div>
</div>
<p>Once we have created a classification measure, we can give it to the <code>$score()</code> method to compute its value for a given <a href="https://mlr3.mlr-org.com/reference/PredictionClassif.html"><code>PredictionClassif</code></a> object:</p>
<div class="cell" data-hash="basics_cache/html/basics-classif-score_5947dbb219bfa53bc2dc3a3b73401de3">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.9557522 </code></pre>
</div>
</div>
<section id="confusion-matrix" class="level4 page-columns page-full" data-number="2.4.3.1"><h4 data-number="2.4.3.1" class="anchored" data-anchor-id="confusion-matrix">
<span class="header-section-number">2.4.3.1</span> Confusion Matrix</h4>
<div class="page-columns page-full"><p>A popular way to show the quality of prediction of a classification model is a confusion matrix. It gives a quick overview of what observations are misclassified, and how they are misclassified. The rows in a confusion matrix are the predicted class and the columns are the true class. All off-diagonal entries are incorrectly classified observations, and all diagonal entries are correctly classified. More information on <a href="https://en.wikipedia.org/wiki/Confusion_matrix">Wikipedia</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;<a href="https://en.wikipedia.org/wiki/Confusion_matrix">https://en.wikipedia.org/wiki/Confusion_matrix</a></p></li></div></div>
<p><a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> supports confusion matrices through the <code>$confusion</code> property of the <a href="https://mlr3.mlr-org.com/reference/PredictionClassif.html"><code>PredictionClassif</code></a> object:</p>
<div class="cell" data-hash="basics_cache/html/basics-049_cfd3001b80ec07553bd8ff864d63c2cc">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>predictions<span class="sc">$</span>confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           truth
response    Adelie Chinstrap Gentoo
  Adelie        49         3      0
  Chinstrap      1        19      1
  Gentoo         0         0     40</code></pre>
</div>
</div>
<p>In this case, our classifier does fairly well classifying the penguins.</p>
</section></section><section id="sec-binary-classif" class="level3" data-number="2.4.4"><h3 data-number="2.4.4" class="anchored" data-anchor-id="sec-binary-classif">
<span class="header-section-number">2.4.4</span> Binary Classification and Positive Classes</h3>
<p>Classification problems with a two-class target are called binary classification tasks. Binary Classification is special in the sense that one of these classes is denoted <em>positive</em> and the other one <em>negative</em>. You can specify the <em>positive class</em> for a <a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>classification task</code></a> object during task creation. If not explicitly set during construction, the positive class defaults to the first level of the target feature.</p>
<div class="cell" data-hash="basics_cache/html/basics-050_c7bd39244ef2077649d8288361843b28">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># during construction</span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="fu">data</span>(<span class="st">"Sonar"</span>, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb116-3"><a href="#cb116-3"></a>task_sonar <span class="ot">=</span> <span class="fu">as_task_classif</span>(Sonar, <span class="at">target =</span> <span class="st">"Class"</span>, <span class="at">positive =</span> <span class="st">"R"</span>)</span>
<span id="cb116-4"><a href="#cb116-4"></a></span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="co"># switch positive class to level 'M'</span></span>
<span id="cb116-6"><a href="#cb116-6"></a>task_sonar<span class="sc">$</span>positive <span class="ot">=</span> <span class="st">"M"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-thresholding" class="level3" data-number="2.4.5"><h3 data-number="2.4.5" class="anchored" data-anchor-id="sec-thresholding">
<span class="header-section-number">2.4.5</span> Thresholding</h3>
<p>Models trained on binary classification tasks that predict the probability for the positive class usually use a simple rule to determine the predicted class label – if the probability is more than 50%, predict the positive label; otherwise, predict the negative label. In some cases, you may want to adjust this threshold, for example, if the classes are very unbalanced (i.e., one is much more prevalent than the other). For example, in the “german_credit” dataset, the credit risk is good for far more observations.</p>
<p>Training a classifier on this data overpredicts the majority class, i.e.&nbsp;the more prevalent class is more likely to be predicted for any given observation.</p>
<div class="cell" data-hash="basics_cache/html/basics-thresholding-1_a77cc9f06bac6661f6354013f1522a5e">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>task_credit <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"german_credit"</span>)</span>
<span id="cb117-2"><a href="#cb117-2"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_credit)</span>
<span id="cb117-3"><a href="#cb117-3"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb117-4"><a href="#cb117-4"></a>learner<span class="sc">$</span><span class="fu">train</span>(task_credit)</span>
<span id="cb117-5"><a href="#cb117-5"></a>predictions <span class="ot">=</span> learner<span class="sc">$</span><span class="fu">predict</span>(task_credit)</span>
<span id="cb117-6"><a href="#cb117-6"></a><span class="fu">autoplot</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-thresholding-1-1.png" class="img-fluid figure-img" alt="A stacked bar plot of predicted values in one bar and ground truth values in the other. The more prevalent class is predicted much more often than it is present in the ground truth data." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the german_credit dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Changing the prediction threshold allows to address this without having to adjust the hyperparameters of the learner or retrain the model.</p>
<div class="cell" data-hash="basics_cache/html/basics-thresholding-2_b4ec81b07cdcfd6f4f53782005ba5c95">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>predictions<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="fl">0.7</span>)</span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="fu">autoplot</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-thresholding-2-1.png" class="img-fluid figure-img" alt="A stacked bar plot of predicted values in one bar and ground truth values in the other. The more prevalent class is now predicted less often and the agreement with the ground truth data is better." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the german_credit dataset with adjusted threshold.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thresholds can be tuned automatically with respect to prediction performance with the <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> package using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_tunethreshold.html"><code>PipeOpTuneThreshold</code></a>. This is covered in <a href="pipelines.html"><span>Chapter&nbsp;6</span></a>.</p>
</div>
</div>
<section id="thresholding-for-multiple-classes" class="level4 unnumbered unlisted"><h4 class="unnumbered unlisted anchored" data-anchor-id="thresholding-for-multiple-classes">Thresholding For Multiple Classes</h4>
<p>For classification tasks with more than two classes you can also adjust the prediction threshold, which is 0.5 for each class by default. Thresholds work slightly differently with multiple classes:</p>
<ul>
<li>The probability for a data point is divided by each class threshold resulting in <code>n</code> ratios for <code>n</code> classes.</li>
<li>The highest ratio is selected (ties are random by default).</li>
</ul>
<p>Lowering the threshold for a class means that it is more likely to be predicted and raising it has the opposite effect. The <a href="https://www.rdocumentation.org/packages/datasets/topics/zoo"><code>zoo</code></a> dataset illustrates this concept nicely.<br>
When trained normally some classes are not predicted at all:</p>
<div class="cell" data-hash="basics_cache/html/basics-thresholding-3_b778a5114bd7f5134adda06a0c897da5">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"zoo"</span>)</span>
<span id="cb119-2"><a href="#cb119-2"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb119-3"><a href="#cb119-3"></a>learner<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb119-4"><a href="#cb119-4"></a>preds <span class="ot">=</span> learner<span class="sc">$</span><span class="fu">predict</span>(task)</span>
<span id="cb119-5"><a href="#cb119-5"></a></span>
<span id="cb119-6"><a href="#cb119-6"></a><span class="fu">autoplot</span>(preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-thresholding-3-1.png" class="img-fluid figure-img" alt="A stacked bar plot of predicted values in one bar and ground truth values in the other. Some classes are predicted more often than in the ground truth data, some less often." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the zoo dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The classes <code>amphibian</code> and <code>insect</code> are never predicted. On the other hand, the classes <code>mollusc</code> and <code>reptile</code> are predicted more often than they appear in the truth data. We can address this by lowering the threshold for <code>amphibian</code> and <code>insect</code>. <code>$set_threshold()</code> can be given a named list to set the threshold for all classes at once:</p>
<div class="cell" data-hash="basics_cache/html/basics-thresholding-4_902296674db817dffdeba4743811a23d">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># c("mammal", "bird", "reptile", "fish", "amphibian", "insect", "mollusc.et.al")</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>new_thresh <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)</span>
<span id="cb120-3"><a href="#cb120-3"></a><span class="fu">names</span>(new_thresh) <span class="ot">=</span> task<span class="sc">$</span>class_names</span>
<span id="cb120-4"><a href="#cb120-4"></a></span>
<span id="cb120-5"><a href="#cb120-5"></a><span class="fu">autoplot</span>(preds<span class="sc">$</span><span class="fu">set_threshold</span>(new_thresh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="basics_files/figure-html/basics-thresholding-4-1.png" class="img-fluid figure-img" alt="A stacked bar plot of predicted values in one bar and ground truth values in the other. The agreement between predicted and ground truth data is better with the adjusted prediction thresholds." width="672"></p>
<p></p><figcaption class="figure-caption">Comparing predicted and ground truth values for the zoo dataset with adjusted thresholds.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can again see that adjusting the thresholds results in better predictive performance, without having to retrain a model.</p>
</section></section></section><section id="sec-task-types-add" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="sec-task-types-add">
<span class="header-section-number">2.5</span> Additional Task Types</h2>
<p>In addition to regression and classification, <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> supports more types of tasks:</p>
<ul>
<li><p>Clustering (<a href="https://mlr3cluster.mlr-org.com/reference/TaskClust.html"><code>mlr3cluster::TaskClust</code></a> in package <a href="https://mlr3cluster.mlr-org.com"><code>mlr3cluster</code></a>): An unsupervised task to identify similar groups within the feature space.</p></li>
<li><p>Survival (<a href="https://mlr3proba.mlr-org.com/reference/TaskSurv.html"><code>mlr3proba::TaskSurv</code></a> in package <a href="https://mlr3proba.mlr-org.com"><code>mlr3proba</code></a>): The target is the (right-censored) time to an event.</p></li>
<li><p>Density (<a href="https://mlr3proba.mlr-org.com/reference/TaskDens.html"><code>mlr3proba::TaskDens</code></a> in package <a href="https://mlr3proba.mlr-org.com"><code>mlr3proba</code></a>): An unsupervised task to estimate the undetectable underlying probability distribution, based on observed data (as a numeric vector or a one-column matrix-like object).</p></li>
</ul>
<p>Other task types that are less common are described in <a href="special.html"><span>Chapter&nbsp;8</span></a>.</p>
</section><section id="sec-lrns-add" class="level2 page-columns page-full" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="sec-lrns-add">
<span class="header-section-number">2.6</span> Additional Learners</h2>
<p>As mentioned above, <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> supports many learners. They can be accessed through three packages: the <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> package, the <a href="https://mlr3learners.mlr-org.com"><code>mlr3learners</code></a> package, and the <a href="https://mlr3extralearners.mlr-org.com"><code>mlr3extralearners</code></a> package.</p>
<p>The list of learners included in the <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> package is dliberately small to avoid large sets of dependencies for this core package:</p>
<ul>
<li>Featureless classifier <a href="https://mlr3.mlr-org.com/reference/mlr_learners_classif.featureless.html"><code>classif.featureless</code></a>: Simple baseline classification learner. Predicts the label that is most frequent in the training set. It can be used as a “fallback learner” to make predictions if another, more sophisticated, learner fails for some reason.</li>
<li>Featureless regressor <a href="https://mlr3.mlr-org.com/reference/mlr_learners_regr.featureless.html"><code>regr.featureless</code></a>: Simple baseline regression learner. Predicts the mean of the target values in the training set.</li>
<li>Rpart decision tree learner <a href="https://mlr3.mlr-org.com/reference/mlr_learners_classif.rpart.html"><code>classif.rpart</code></a>: Tree learner from <a href="https://cran.r-project.org/package=rpart"><code>rpart</code></a>.</li>
<li>Rpart regression tree learner <a href="https://mlr3.mlr-org.com/reference/mlr_learners_regr.rpart.html"><code>regr.rpart</code></a>: Tree learner from <a href="https://cran.r-project.org/package=rpart"><code>rpart</code></a>.</li>
</ul>
<p>The <a href="https://mlr3learners.mlr-org.com"><code>mlr3learners</code></a> package contains cherry-picked implementations of the most popular machine learning methods:</p>
<ul>
<li>Linear (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.lm.html"><code>regr.lm</code></a>) and logistic (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.log_reg.html"><code>classif.log_reg</code></a>) regression.</li>
<li>Penalized Generalized Linear Models (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.glmnet.html"><code>regr.glmnet</code></a>, <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.glmnet.html"><code>classif.glmnet</code></a>), possibly with built-in optimization of the penalization parameter (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.cv_glmnet.html"><code>regr.cv_glmnet</code></a>, <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.cv_glmnet.html"><code>classif.cv_glmnet</code></a>).</li>
<li>(Kernelized) <span class="math inline">\(k\)</span>-Nearest Neighbors regression (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.kknn.html"><code>regr.kknn</code></a>) and classification (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.kknn.html"><code>classif.kknn</code></a>).</li>
<li>Kriging / Gaussian Process Regression (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.km.html"><code>regr.km</code></a>).</li>
<li>Linear (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.lda.html"><code>classif.lda</code></a>) and Quadratic (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.qda.html"><code>classif.qda</code></a>) Discriminant Analysis.</li>
<li>Naïve Bayes Classification (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.naive_bayes.html"><code>classif.naive_bayes</code></a>).</li>
<li>Support-Vector machines (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.svm.html"><code>regr.svm</code></a>, <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.svm.html"><code>classif.svm</code></a>).</li>
<li>Gradient Boosting (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.xgboost.html"><code>regr.xgboost</code></a>, <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.xgboost.html"><code>classif.xgboost</code></a>).</li>
<li>Random Forests for regression and classification (<a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.ranger.html"><code>regr.ranger</code></a>, <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.ranger.html"><code>classif.ranger</code></a>).</li>
</ul>
<div class="page-columns page-full"><p>A complete list of supported learners across all <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> packages is hosted on <a href="https://mlr-org.com/learners.html">our website</a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;<a href="https://mlr-org.com/learners.html">https://mlr-org.com/learners.html</a></p></li></div></div>
<p>The dictionary <a href="https://mlr3.mlr-org.com/reference/mlr_learners.html"><code>mlr_learners</code></a> contains the supported learners and changes as packages are loaded. At the time of writing, <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> supports six learners, <a href="https://mlr3learners.mlr-org.com/reference/mlr3learners-package.html"><code>mlr3learners</code></a> 21 learners, <a href="https://mlr3extralearners.mlr-org.com/reference/mlr3extralearners-package.html"><code>mlr3extralearners</code></a> 88 learners, <a href="https://mlr3proba.mlr-org.com/reference/mlr3proba-package.html"><code>mlr3proba</code></a> five learners, and <a href="https://mlr3cluster.mlr-org.com/reference/mlr3cluster-package.html"><code>mlr3cluster</code></a> 19 learners.</p>
<section id="sec-lrns-add-list" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="sec-lrns-add-list">
<span class="header-section-number">2.6.1</span> Listing Learners</h3>
<p>You can list all learners by converting the <a href="https://mlr3.mlr-org.com/reference/mlr_learners.html"><code>mlr_learners</code></a> dictionary into a <code>data.table</code>:</p>
<div class="cell" data-hash="basics_cache/html/basics-learners-list_570dbce9a34878d489bde4d20d7711fb">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="fu">as.data.table</span>(mlr_learners)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     key                       label task_type
  1:  classif.AdaBoostM1           Adaptive Boosting   classif
  2:         classif.C50            Tree-based Model   classif
  3:         classif.IBk           Nearest Neighbour   classif
  4:         classif.J48            Tree-based Model   classif
  5:        classif.JRip Propositional Rule Learner.   classif
 ---                                                          
136: surv.priority_lasso              Priority Lasso      surv
137:         surv.ranger               Random Forest      surv
138:          surv.rfsrc               Random Forest      surv
139:            surv.svm      Support Vector Machine      surv
140:        surv.xgboost           Gradient Boosting      surv
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
<p>The resulting <code>data.table</code> contains a lot of meta-data that is useful for identifying learners that have particular properties. For example, we can list all learners that support regression problems:</p>
<div class="cell" data-hash="basics_cache/html/basics-learners-list-regr_513643327a1d9ba11ce5c0c893a34129">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"regr"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              key                                     label task_type
 1:      regr.IBk                       K-nearest neighbour      regr
 2:  regr.M5Rules                      Rule-based Algorithm      regr
 3:    regr.abess Fast Best Subset Selection for Regression      regr
 4:     regr.bart        Bayesian Additive Regression Trees      regr
 5: regr.catboost                         Gradient Boosting      regr
---                                                                  
35:    regr.rpart                           Regression Tree      regr
36:      regr.rsm                    Response Surface Model      regr
37:      regr.rvm                  Relevance Vector Machine      regr
38:      regr.svm                                      &lt;NA&gt;      regr
39:  regr.xgboost                                      &lt;NA&gt;      regr
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
<p>We can check multiple conditions, to for example find all learners that support regression problems and can predict standard errors:</p>
<div class="cell" data-hash="basics_cache/html/basics-learners-regr-se_633700cee4d6d32cfee5d5e19a542f1f">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"regr"</span> <span class="sc">&amp;</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>    <span class="fu">sapply</span>(predict_types, <span class="cf">function</span>(x) <span class="st">"se"</span> <span class="sc">%in%</span> x)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                key                                    label task_type
1:       regr.debug             Debug Learner for Regression      regr
2:       regr.earth Multivariate Adaptive Regression Splines      regr
3: regr.featureless           Featureless Regression Learner      regr
4:         regr.gam    Generalized Additive Regression Model      regr
5:         regr.glm            Generalized Linear Regression      regr
6:          regr.km                                     &lt;NA&gt;      regr
7:          regr.lm                                     &lt;NA&gt;      regr
8:         regr.mob       Model-based Recursive Partitioning      regr
9:      regr.ranger                                     &lt;NA&gt;      regr
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
<p>Or we can list all learners that support classification problems and missing feature values:</p>
<div class="cell" data-hash="basics_cache/html/basics-learners-classif-missings_9dd5fc2005990af238cdb0cbf2b73431">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"classif"</span> <span class="sc">&amp;</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>    <span class="fu">sapply</span>(properties, <span class="cf">function</span>(x) <span class="st">"missings"</span> <span class="sc">%in%</span> x)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         key                              label task_type
 1:              classif.C50                   Tree-based Model   classif
 2:              classif.J48                   Tree-based Model   classif
 3:             classif.PART                   Tree-based Model   classif
 4:         classif.catboost                  Gradient Boosting   classif
 5:            classif.debug   Debug Learner for Classification   classif
 6:      classif.featureless Featureless Classification Learner   classif
 7:              classif.gbm                  Gradient Boosting   classif
 8: classif.imbalanced_rfsrc           Imbalanced Random Forest   classif
 9:         classif.lightgbm                  Gradient Boosting   classif
10:            classif.rfsrc                      Random Forest   classif
11:            classif.rpart                Classification Tree   classif
12:          classif.xgboost                               &lt;NA&gt;   classif
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
</section></section><section id="exercises" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">2.7</span> Exercises</h2>
<ol type="1">
<li>Using the <a href="https://mlr3.mlr-org.com/reference/mlr_tasks_sonar.html"><code>Sonar dataset</code></a>, measure the classification error (<code>classif.ce</code>) of a classification tree model (<code>classif.rpart</code>) trained with default hyperparameters on 80% of the data and tested on the remaining 20%.</li>
<li>Give the true positive, false positive, true negative, and false negative rates of the predictions made by the model in problem 1.</li>
<li>Change the threshold of the model from problem 1 such that the false positive rate is lower than the false negative rate. Give a reason why you might do this.</li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-bishop_2006" class="csl-entry" role="doc-biblioentry">
Bishop, Christopher M. 2006. <em>Pattern Recognition and Machine Learning</em>. Springer.
</div>
<div id="ref-hastie2001" class="csl-entry" role="doc-biblioentry">
Hastie, Trevor, Jerome Friedman, and Robert Tibshirani. 2001. <em>The Elements of Statistical Learning</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-21606-5">https://doi.org/10.1007/978-0-387-21606-5</a>.
</div>
<div id="ref-james_introduction_2014" class="csl-entry" role="doc-biblioentry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2014. <em>An Introduction to Statistical Learning: With Applications in r</em>. Springer Publishing Company, Incorporated.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./performance.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Resampling and Benchmarking</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb129" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Natalie Foss</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid:</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co">    email: nfoss2@uwyo.edu</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: University of Wyoming</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Lars Kotthoff</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0003-4635-6873</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="co">    email: larsko@uwyo.edu</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: University of Wyoming</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="co">    We describe and explain the basic building blocks of mlr3 and how to train and evaluate simple machine learning models.</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="co">    The chapter introduces the different types of tasks that mlr3 supports and how to work with them, learners and how to train models, how to make predictions using those trained models, and how to evaluate the quality of the predictions in a principled fashion.</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Only the basic concepts are introduced, but we give pointers on where to learn more in the rest of the book, and overviews of other concepts.</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a><span class="co">    After reading this chapter, you will be able to use mlr3 for most machine learning workflows.</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fundamentals {#sec-basics}</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>{{&lt; include _setup.qmd &gt;}}</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>In this chapter, we will introduce the <span class="in">`r mlr3`</span> objects and corresponding <span class="in">`r ref_pkg("R6")`</span> classes that implement the essential building blocks of machine learning.</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>These building blocks include the data (and the methods of creating training and test sets), the machine learning algorithm (and its training and prediction process), and evaluation measures to assess the quality of predictions.</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>In essence, machine learning means learning relationships from data.</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>In supervised learning, datasets consist of observations (rows in tabular data) that are labeled, which means that each data point includes features (columns in tabular data) and a quantity that we are trying to predict, also called 'target'.</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>For example, we might want to predict the miles per gallon a car gets based on features such as its horsepower and the number of gears.</span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>Data and information on what they represent, along with what quantities to predict are called "tasks" in <span class="in">`r mlr3`</span> (@sec-tasks) -- they can be thought of as machine learning tasks we are trying to solve.</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>There can be more than one task per dataset, for example ones that include different sets of features, observations, or predict different target quantities.</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>Supervised learning can be further divided into regression (predicting numeric target values) and classification (predicting categorical target values/labels).</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>In either case, the goal is to build a model that captures the relationship between features and target.</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>We can build such models using machine learning algorithms, for example decision trees, support vector machines, neural networks, and many more.</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>A machine learning algorithm, given training data, induces such a model.</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>Machine learning algorithms are called "learners" in <span class="in">`r mlr3`</span> (@sec-learners) -- given data, they learn models.</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>Each learner has a parameterized space that potential models are drawn from and during the training process, these parameters are fitted to best match the data.</span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>For example, the parameters could be the weights given to individual features when predicting a quantity in linear regression.</span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>For other learners, the parameters are not as explicit, for example for decision tree learners where a fitted model corresponds to a particular decision tree.</span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>All learners optimize a so-called loss function during training, i.e. training a learner means finding the model that optimizes the loss.</span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>In general, a loss function quantifies the mismatch between ground truth target values in the training data and the predictions of the model.</span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>Given a model, we can make predictions (@sec-predicting) on new data.</span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a>A model is only useful though if it generalizes beyond the training data.</span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a>Otherwise, we could build a perfect model by simply memorizing the training data.</span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>Therefore, separate test data is used to evaluate models in an unbiased way and to assess to what extent they have learned the true relationships that underlie the data (@sec-performance).</span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>We can evaluate models in <span class="in">`r mlr3`</span> in many ways (@sec-eval).</span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>In general, we use the same kind of loss function that the learner used to build the model, but now with data that was not used during training.</span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>The performance of a model, quantified by the value of the loss function when evaluated on new data, is called the estimated of the generalization error -- how well do we expect this model to do in general?</span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> calls loss functions "measures".</span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a>We can use different measures for training and testing, although it makes most sense for the measures to be the same.</span>
<span id="cb129-53"><a href="#cb129-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-54"><a href="#cb129-54" aria-hidden="true" tabindex="-1"></a>Much more information on (supervised) machine learning can be found in @hastie2001, @james_introduction_2014, or @bishop_2006.</span>
<span id="cb129-55"><a href="#cb129-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-56"><a href="#cb129-56" aria-hidden="true" tabindex="-1"></a>The basic idea is illustrated in the following figure:</span>
<span id="cb129-57"><a href="#cb129-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-58"><a href="#cb129-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-fig-1, echo=FALSE}</span></span>
<span id="cb129-59"><a href="#cb129-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ml-abstraction</span></span>
<span id="cb129-60"><a href="#cb129-60" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "General overview of the machine learning process."</span></span>
<span id="cb129-61"><a href="#cb129-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: "center"</span></span>
<span id="cb129-62"><a href="#cb129-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A flowchart starting with the task (data), which splits into training- and test sets. The training set is used with the learner to fit a model, which is then used with the test set to make predictions. A performance measure is applied to the predictions and results in a performance estimate. Resampling refers to the repeated application of this process."</span></span>
<span id="cb129-63"><a href="#cb129-63" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/ml_abstraction.svg"</span>)</span>
<span id="cb129-64"><a href="#cb129-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-65"><a href="#cb129-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-66"><a href="#cb129-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-67"><a href="#cb129-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tasks {#sec-tasks}</span></span>
<span id="cb129-68"><a href="#cb129-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-69"><a href="#cb129-69" aria-hidden="true" tabindex="-1"></a>Tasks are objects that contain the (usually tabular) data and additional meta-data that define a machine learning problem.</span>
<span id="cb129-70"><a href="#cb129-70" aria-hidden="true" tabindex="-1"></a>The meta-data contain, for example, the name of the target feature for supervised machine learning problems.</span>
<span id="cb129-71"><a href="#cb129-71" aria-hidden="true" tabindex="-1"></a>This information is used automatically by operations that can be performed on a task so that for example the user does not have to specify the prediction target every time a model is trained.</span>
<span id="cb129-72"><a href="#cb129-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-73"><a href="#cb129-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Built-in Tasks {#sec-tasks-built-in}</span></span>
<span id="cb129-74"><a href="#cb129-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-75"><a href="#cb129-75" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> includes a few predefined machine learning tasks in an R6 <span class="in">`Dictionary`</span> named <span class="in">`r ref("mlr_tasks")`</span>.</span>
<span id="cb129-76"><a href="#cb129-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-77"><a href="#cb129-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-001}</span></span>
<span id="cb129-78"><a href="#cb129-78" aria-hidden="true" tabindex="-1"></a>mlr_tasks</span>
<span id="cb129-79"><a href="#cb129-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-80"><a href="#cb129-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-81"><a href="#cb129-81" aria-hidden="true" tabindex="-1"></a>To get a task from the dictionary, use the <span class="in">`r ref("tsk()")`</span> function and assign the return value to a new variable.</span>
<span id="cb129-82"><a href="#cb129-82" aria-hidden="true" tabindex="-1"></a>Here, we retrieve the <span class="in">`r ref("mlr_tasks_mtcars", text = "mtcars regression task")`</span>, which is provided by the package <span class="in">`r ref_pkg("datasets")`</span>:</span>
<span id="cb129-83"><a href="#cb129-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-84"><a href="#cb129-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-002}</span></span>
<span id="cb129-85"><a href="#cb129-85" aria-hidden="true" tabindex="-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb129-86"><a href="#cb129-86" aria-hidden="true" tabindex="-1"></a>task_mtcars</span>
<span id="cb129-87"><a href="#cb129-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-88"><a href="#cb129-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-89"><a href="#cb129-89" aria-hidden="true" tabindex="-1"></a>To get more information about a particular task, it is easiest to use the <span class="in">`help()`</span> method that all <span class="in">`r mlr3`</span>-objects come with:</span>
<span id="cb129-90"><a href="#cb129-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-91"><a href="#cb129-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-003, eval = FALSE}</span></span>
<span id="cb129-92"><a href="#cb129-92" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span><span class="fu">help</span>()</span>
<span id="cb129-93"><a href="#cb129-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-94"><a href="#cb129-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-95"><a href="#cb129-95" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-96"><a href="#cb129-96" aria-hidden="true" tabindex="-1"></a>If you are familiar with R's help system (i.e. the <span class="in">`help()`</span> and <span class="in">`?`</span> functions), this may seem confusing.</span>
<span id="cb129-97"><a href="#cb129-97" aria-hidden="true" tabindex="-1"></a><span class="in">`task_mtcars`</span> is the variable that holds the mtcars task, not a function, and hence we cannot use <span class="in">`help()`</span> or <span class="in">`?`</span>.</span>
<span id="cb129-98"><a href="#cb129-98" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-99"><a href="#cb129-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-100"><a href="#cb129-100" aria-hidden="true" tabindex="-1"></a>Alternatively, the corresponding man page can be found under <span class="in">`mlr_tasks_&lt;id&gt;`</span>, e.g.</span>
<span id="cb129-101"><a href="#cb129-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-102"><a href="#cb129-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-004, eval = FALSE}</span></span>
<span id="cb129-103"><a href="#cb129-103" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">"mlr_tasks_mtcars"</span>)</span>
<span id="cb129-104"><a href="#cb129-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-105"><a href="#cb129-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-106"><a href="#cb129-106" aria-hidden="true" tabindex="-1"></a>We can also load the data separately and convert it to a task, without using the <span class="in">`tsk()`</span> function that <span class="in">`r mlr3`</span> provides.</span>
<span id="cb129-107"><a href="#cb129-107" aria-hidden="true" tabindex="-1"></a>If the data we want to use does not come with <span class="in">`r mlr3`</span>, it has to be done this way.</span>
<span id="cb129-108"><a href="#cb129-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-109"><a href="#cb129-109" aria-hidden="true" tabindex="-1"></a>For example, the data for <span class="in">`r ref("datasets::mtcars", text = "mtcars")`</span> is also available separately, as a <span class="in">`data.frame()`</span> and not a task.</span>
<span id="cb129-110"><a href="#cb129-110" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("datasets::mtcars", text = "mtcars")`</span> contains characteristics for different types of cars, along with their fuel consumption.</span>
<span id="cb129-111"><a href="#cb129-111" aria-hidden="true" tabindex="-1"></a>We want to predict the numeric target feature stored in column <span class="in">`"mpg"`</span> (miles per gallon).</span>
<span id="cb129-112"><a href="#cb129-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-113"><a href="#cb129-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-006}</span></span>
<span id="cb129-114"><a href="#cb129-114" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>, <span class="at">package =</span> <span class="st">"datasets"</span>)</span>
<span id="cb129-115"><a href="#cb129-115" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span>
<span id="cb129-116"><a href="#cb129-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-117"><a href="#cb129-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-118"><a href="#cb129-118" aria-hidden="true" tabindex="-1"></a>We create the regression task, i.e. we construct a new instance of the R6 class <span class="in">`r ref("TaskRegr")`</span>.</span>
<span id="cb129-119"><a href="#cb129-119" aria-hidden="true" tabindex="-1"></a>An easy way to do this is to use the function <span class="in">`r ref("as_task_regr()")`</span> to convert our <span class="in">`data.frame()`</span> to a regression task, specifying the target feature in an additional argument.</span>
<span id="cb129-120"><a href="#cb129-120" aria-hidden="true" tabindex="-1"></a>Before we give the data to <span class="in">`r ref("as_task_regr()")`</span>, we can process it using the usual R functions, for example to select a subset of data.</span>
<span id="cb129-121"><a href="#cb129-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-122"><a href="#cb129-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-123"><a href="#cb129-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-007}</span></span>
<span id="cb129-124"><a href="#cb129-124" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mlr3"</span>)</span>
<span id="cb129-125"><a href="#cb129-125" aria-hidden="true" tabindex="-1"></a>mtcars_subset <span class="ot">=</span> <span class="fu">subset</span>(mtcars, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"cyl"</span>, <span class="st">"disp"</span>))</span>
<span id="cb129-126"><a href="#cb129-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-127"><a href="#cb129-127" aria-hidden="true" tabindex="-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">as_task_regr</span>(mtcars_subset, <span class="at">target =</span> <span class="st">"mpg"</span>, <span class="at">id =</span> <span class="st">"cars"</span>)</span>
<span id="cb129-128"><a href="#cb129-128" aria-hidden="true" tabindex="-1"></a>task_mtcars</span>
<span id="cb129-129"><a href="#cb129-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-130"><a href="#cb129-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-131"><a href="#cb129-131" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-132"><a href="#cb129-132" aria-hidden="true" tabindex="-1"></a>The task constructors <span class="in">`r ref("as_task_regr()")`</span> and <span class="in">`r ref("as_task_classif()")`</span> will check for non-ASCII characters in the column names of your data.</span>
<span id="cb129-133"><a href="#cb129-133" aria-hidden="true" tabindex="-1"></a>As many ML models do not work properly with arbitrary <span class="co">[</span><span class="ot">UTF8 names</span><span class="co">](https://en.wikipedia.org/wiki/UTF-8)</span>, <span class="in">`r mlr3`</span> defaults to throw an error if any of the column names contains either a non-ASCII character or does not comply with R's variable naming scheme.</span>
<span id="cb129-134"><a href="#cb129-134" aria-hidden="true" tabindex="-1"></a>We generally recommend converting names with <span class="in">`r ref("make.names()")`</span> first, but you can also set the option <span class="in">`mlr3.allow_utf8_names`</span> to true to relax the check (but do not be surprised if a model fails).</span>
<span id="cb129-135"><a href="#cb129-135" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-136"><a href="#cb129-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-137"><a href="#cb129-137" aria-hidden="true" tabindex="-1"></a>The data can be any rectangular data format, e.g. a <span class="in">`data.frame()`</span>, <span class="in">`data.table()`</span>, or <span class="in">`tibble()`</span>.</span>
<span id="cb129-138"><a href="#cb129-138" aria-hidden="true" tabindex="-1"></a>Internally, the data is converted and stored in a <span class="in">`r ref("DataBackend")`</span>.</span>
<span id="cb129-139"><a href="#cb129-139" aria-hidden="true" tabindex="-1"></a>The <span class="in">`target`</span> argument specifies the prediction target column.</span>
<span id="cb129-140"><a href="#cb129-140" aria-hidden="true" tabindex="-1"></a>The <span class="in">`id`</span> argument is optional and specifies an identifier for the task that is used in plots and summaries.</span>
<span id="cb129-141"><a href="#cb129-141" aria-hidden="true" tabindex="-1"></a>If no <span class="in">`id`</span> is given provided, the deparsed name of the data will be used (an R way of turning data into strings).</span>
<span id="cb129-142"><a href="#cb129-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-143"><a href="#cb129-143" aria-hidden="true" tabindex="-1"></a>Printing a task gives a short summary: it has <span class="in">`r task_mtcars$nrow`</span> observations and <span class="in">`r task_mtcars$ncol`</span> columns, of which <span class="in">`mpg`</span> is the target and <span class="in">`r length(task_mtcars$feature_names)`</span> are features stored in double-precision floating point format.</span>
<span id="cb129-144"><a href="#cb129-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-145"><a href="#cb129-145" aria-hidden="true" tabindex="-1"></a>We can plot the task using the <span class="in">`r mlr3viz`</span> package, which gives a graphical summary of the distribution of the target and feature values:</span>
<span id="cb129-146"><a href="#cb129-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-147"><a href="#cb129-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-008, message=FALSE}</span></span>
<span id="cb129-148"><a href="#cb129-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Overview of the mtcars dataset."</span></span>
<span id="cb129-149"><a href="#cb129-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Diagram showing the distribution of target and feature values in the mtcars data.</span></span>
<span id="cb129-150"><a href="#cb129-150" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb129-151"><a href="#cb129-151" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(task_mtcars, <span class="at">type =</span> <span class="st">"pairs"</span>)</span>
<span id="cb129-152"><a href="#cb129-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-153"><a href="#cb129-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-154"><a href="#cb129-154" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-155"><a href="#cb129-155" aria-hidden="true" tabindex="-1"></a>Instead of loading multiple extension packages individually, it is often more convenient to load the <span class="in">`r mlr3verse`</span> package instead.</span>
<span id="cb129-156"><a href="#cb129-156" aria-hidden="true" tabindex="-1"></a>It makes the functions from most <span class="in">`r mlr3`</span> packages that are used for common machine learning and data science tasks available.</span>
<span id="cb129-157"><a href="#cb129-157" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-158"><a href="#cb129-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-159"><a href="#cb129-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retrieving Data {#sec-retrieve-data}</span></span>
<span id="cb129-160"><a href="#cb129-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-161"><a href="#cb129-161" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("Task")`</span> object primarily represents a tabular dataset, combined with meta-data about which columns of that data should be used to predict which other columns in what way, and some more information about column data types.</span>
<span id="cb129-162"><a href="#cb129-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-163"><a href="#cb129-163" aria-hidden="true" tabindex="-1"></a>Various fields can be used to retrieve meta-data about a task. The dimensions, for example, can be retrieved using <span class="in">`$nrow`</span> and <span class="in">`$ncol`</span>:</span>
<span id="cb129-164"><a href="#cb129-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-165"><a href="#cb129-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-009}</span></span>
<span id="cb129-166"><a href="#cb129-166" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span>nrow</span>
<span id="cb129-167"><a href="#cb129-167" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span>ncol</span>
<span id="cb129-168"><a href="#cb129-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-169"><a href="#cb129-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-170"><a href="#cb129-170" aria-hidden="true" tabindex="-1"></a>The names of the feature and target columns are stored in the <span class="in">`$feature_names`</span> and <span class="in">`$target_names`</span> slots, respectively. Here, "target" refers to the feature we want to predict and "feature" to the predictors for the task.</span>
<span id="cb129-171"><a href="#cb129-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-172"><a href="#cb129-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-010}</span></span>
<span id="cb129-173"><a href="#cb129-173" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span>feature_names</span>
<span id="cb129-174"><a href="#cb129-174" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span>target_names</span>
<span id="cb129-175"><a href="#cb129-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-176"><a href="#cb129-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-177"><a href="#cb129-177" aria-hidden="true" tabindex="-1"></a>While the columns of a task have unique <span class="in">`character`</span>-valued names, their rows are identified by unique natural numbers, called row IDs.</span>
<span id="cb129-178"><a href="#cb129-178" aria-hidden="true" tabindex="-1"></a>They can be accessed through the <span class="in">`$row_ids`</span> slot:</span>
<span id="cb129-179"><a href="#cb129-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-180"><a href="#cb129-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-011}</span></span>
<span id="cb129-181"><a href="#cb129-181" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(task_mtcars<span class="sc">$</span>row_ids)</span>
<span id="cb129-182"><a href="#cb129-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-183"><a href="#cb129-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-184"><a href="#cb129-184" aria-hidden="true" tabindex="-1"></a>Row IDs are not used as features when predicting; they are meta-data that allows to access individual observations.</span>
<span id="cb129-185"><a href="#cb129-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-186"><a href="#cb129-186" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb129-187"><a href="#cb129-187" aria-hidden="true" tabindex="-1"></a>Although the row IDs are typically just the sequence from <span class="in">`1`</span> to <span class="in">`nrow(data)`</span>, they are only guaranteed to be unique natural numbers. It is possible that they do not start at <span class="in">`1`</span>, that they are not increasing by 1 each, or that they are not even in increasing order.</span>
<span id="cb129-188"><a href="#cb129-188" aria-hidden="true" tabindex="-1"></a>This allows to transparently operate on real database management systems, where uniqueness is the only requirement for primary keys.</span>
<span id="cb129-189"><a href="#cb129-189" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-190"><a href="#cb129-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-191"><a href="#cb129-191" aria-hidden="true" tabindex="-1"></a>The data contained in a task can be accessed through <span class="in">`$data()`</span>, which returns a <span class="in">`data.table`</span> object.</span>
<span id="cb129-192"><a href="#cb129-192" aria-hidden="true" tabindex="-1"></a>It has optional <span class="in">`rows`</span> and <span class="in">`cols`</span> arguments to specify subsets of the data to retrieve.</span>
<span id="cb129-193"><a href="#cb129-193" aria-hidden="true" tabindex="-1"></a>When a database backend is used, this avoids loading unnecessary data into memory, making it more efficient than retrieving the entire data first and then subsetting it using <span class="in">`[&lt;rows&gt;, &lt;cols&gt;]`</span>.</span>
<span id="cb129-194"><a href="#cb129-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-195"><a href="#cb129-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-012}</span></span>
<span id="cb129-196"><a href="#cb129-196" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb129-197"><a href="#cb129-197" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve data for rows with IDs 1, 5, and 10 and column "mpg"</span></span>
<span id="cb129-198"><a href="#cb129-198" aria-hidden="true" tabindex="-1"></a>task_mtcars<span class="sc">$</span><span class="fu">data</span>(<span class="at">rows =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="at">cols =</span> <span class="st">"mpg"</span>)</span>
<span id="cb129-199"><a href="#cb129-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-200"><a href="#cb129-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-201"><a href="#cb129-201" aria-hidden="true" tabindex="-1"></a>A shortcut to extract all data from a task is to simply convert it to a <span class="in">`data.table`</span>:</span>
<span id="cb129-202"><a href="#cb129-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-203"><a href="#cb129-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-013}</span></span>
<span id="cb129-204"><a href="#cb129-204" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary of all data</span></span>
<span id="cb129-205"><a href="#cb129-205" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.data.table</span>(task_mtcars))</span>
<span id="cb129-206"><a href="#cb129-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-207"><a href="#cb129-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-208"><a href="#cb129-208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Task Mutators {#sec-tasks-mutators}</span></span>
<span id="cb129-209"><a href="#cb129-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-210"><a href="#cb129-210" aria-hidden="true" tabindex="-1"></a>It is often necessary to create tasks that encompass subsets of other tasks' data, for example to manually create <span class="co">[</span><span class="ot">train-test-splits</span><span class="co">](#train-test-splits)</span>, or to fit models on a subset of given features.</span>
<span id="cb129-211"><a href="#cb129-211" aria-hidden="true" tabindex="-1"></a>Restricting tasks to a given set of features can be done by calling <span class="in">`$select()`</span> with the desired feature names.</span>
<span id="cb129-212"><a href="#cb129-212" aria-hidden="true" tabindex="-1"></a>Restriction to rows (observations) is done with <span class="in">`$filter()`</span> with the row IDs.</span>
<span id="cb129-213"><a href="#cb129-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-214"><a href="#cb129-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-014}</span></span>
<span id="cb129-215"><a href="#cb129-215" aria-hidden="true" tabindex="-1"></a>task_mtcars_small <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>) <span class="co"># initialize with the full task</span></span>
<span id="cb129-216"><a href="#cb129-216" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"am"</span>, <span class="st">"carb"</span>)) <span class="co"># keep only these features</span></span>
<span id="cb129-217"><a href="#cb129-217" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>) <span class="co"># keep only these rows</span></span>
<span id="cb129-218"><a href="#cb129-218" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb129-219"><a href="#cb129-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-220"><a href="#cb129-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-221"><a href="#cb129-221" aria-hidden="true" tabindex="-1"></a>These methods are so-called *mutators*; they modify the given <span class="in">`Task`</span> in place.</span>
<span id="cb129-222"><a href="#cb129-222" aria-hidden="true" tabindex="-1"></a>If you want to have an unmodified version of the task, you need to use the <span class="in">`$clone()`</span> method to create a copy first.</span>
<span id="cb129-223"><a href="#cb129-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-224"><a href="#cb129-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-015}</span></span>
<span id="cb129-225"><a href="#cb129-225" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller <span class="ot">=</span> task_mtcars_small<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb129-226"><a href="#cb129-226" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span>)</span>
<span id="cb129-227"><a href="#cb129-227" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb129-228"><a href="#cb129-228" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()  <span class="co"># the original task is unmodified</span></span>
<span id="cb129-229"><a href="#cb129-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-230"><a href="#cb129-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-231"><a href="#cb129-231" aria-hidden="true" tabindex="-1"></a>Note also how the last call to <span class="in">`$filter(2)`</span> did not select the second row of <span class="in">`task_mtcars_small`</span>, but the row with ID 2, which is the *first* row of <span class="in">`task_mtcars_small`</span>.</span>
<span id="cb129-232"><a href="#cb129-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-233"><a href="#cb129-233" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-234"><a href="#cb129-234" aria-hidden="true" tabindex="-1"></a>If you need to work with row numbers instead of row IDs, you can work on the vector of row IDs:</span>
<span id="cb129-235"><a href="#cb129-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-236"><a href="#cb129-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-016, eval = FALSE}</span></span>
<span id="cb129-237"><a href="#cb129-237" aria-hidden="true" tabindex="-1"></a><span class="co"># keep the 2nd row:</span></span>
<span id="cb129-238"><a href="#cb129-238" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">=</span> task_mtcars_small<span class="sc">$</span>row_ids[<span class="dv">2</span>] <span class="co"># extracts ID of 2nd row</span></span>
<span id="cb129-239"><a href="#cb129-239" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">filter</span>(keep)</span>
<span id="cb129-240"><a href="#cb129-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-241"><a href="#cb129-241" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-242"><a href="#cb129-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-243"><a href="#cb129-243" aria-hidden="true" tabindex="-1"></a>The methods above allow to subset the data; the methods <span class="in">`$rbind()`</span> and <span class="in">`$cbind()`</span> allow to add extra rows and columns to a task.</span>
<span id="cb129-244"><a href="#cb129-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-245"><a href="#cb129-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-017}</span></span>
<span id="cb129-246"><a href="#cb129-246" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">rbind</span>( <span class="co"># add another row</span></span>
<span id="cb129-247"><a href="#cb129-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">mpg =</span> <span class="dv">23</span>, <span class="at">am =</span> <span class="dv">0</span>, <span class="at">carb =</span> <span class="dv">3</span>)</span>
<span id="cb129-248"><a href="#cb129-248" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-249"><a href="#cb129-249" aria-hidden="true" tabindex="-1"></a>task_mtcars_smaller<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb129-250"><a href="#cb129-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-251"><a href="#cb129-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-252"><a href="#cb129-252" aria-hidden="true" tabindex="-1"></a><span class="fu">### Roles (Rows and Columns) {#sec-tasks-roles}</span></span>
<span id="cb129-253"><a href="#cb129-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-254"><a href="#cb129-254" aria-hidden="true" tabindex="-1"></a>{{&lt; include _optional.qmd &gt;}}</span>
<span id="cb129-255"><a href="#cb129-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-256"><a href="#cb129-256" aria-hidden="true" tabindex="-1"></a>We have seen that certain columns are designated as "targets" and "features" during task creation; <span class="in">`r mlr3`</span> calls this "roles".</span>
<span id="cb129-257"><a href="#cb129-257" aria-hidden="true" tabindex="-1"></a>Target refers to the column(s) we want to predict and features are the predictors (also called co-variates or descriptors) for the target.</span>
<span id="cb129-258"><a href="#cb129-258" aria-hidden="true" tabindex="-1"></a>Besides these two, there are other possible roles for columns.</span>
<span id="cb129-259"><a href="#cb129-259" aria-hidden="true" tabindex="-1"></a>The roles affect the behavior of the task for different operations.</span>
<span id="cb129-260"><a href="#cb129-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-261"><a href="#cb129-261" aria-hidden="true" tabindex="-1"></a>The <span class="in">`task_mtcars_small`</span> task, for example, has the following column roles:</span>
<span id="cb129-262"><a href="#cb129-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-263"><a href="#cb129-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-018}</span></span>
<span id="cb129-264"><a href="#cb129-264" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span>col_roles</span>
<span id="cb129-265"><a href="#cb129-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-266"><a href="#cb129-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-267"><a href="#cb129-267" aria-hidden="true" tabindex="-1"></a>As you can see, there are additional column roles; the interested reader is referred to the documentation of <span class="in">`r ref("Task")`</span> for more detail.</span>
<span id="cb129-268"><a href="#cb129-268" aria-hidden="true" tabindex="-1"></a>We can list all supported column roles by printing the names of the field <span class="in">`$col_roles`</span>:</span>
<span id="cb129-269"><a href="#cb129-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-270"><a href="#cb129-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-019}</span></span>
<span id="cb129-271"><a href="#cb129-271" aria-hidden="true" tabindex="-1"></a><span class="co"># supported column roles, see ?Task</span></span>
<span id="cb129-272"><a href="#cb129-272" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(task_mtcars_small<span class="sc">$</span>col_roles)</span>
<span id="cb129-273"><a href="#cb129-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-274"><a href="#cb129-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-275"><a href="#cb129-275" aria-hidden="true" tabindex="-1"></a>Columns can have multiple roles.</span>
<span id="cb129-276"><a href="#cb129-276" aria-hidden="true" tabindex="-1"></a>It is also possible for a column to have no role at all, in which case they are ignored.</span>
<span id="cb129-277"><a href="#cb129-277" aria-hidden="true" tabindex="-1"></a>This is, in fact, how <span class="in">`$select()`</span> and <span class="in">`$filter()`</span> operate: They unassign the <span class="in">`"feature"`</span> (for columns) or <span class="in">`"use"`</span> (for rows) role without modifying the data which is stored in an immutable backend:</span>
<span id="cb129-278"><a href="#cb129-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-279"><a href="#cb129-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-020}</span></span>
<span id="cb129-280"><a href="#cb129-280" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span>backend</span>
<span id="cb129-281"><a href="#cb129-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-282"><a href="#cb129-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-283"><a href="#cb129-283" aria-hidden="true" tabindex="-1"></a>There are two main ways to manipulate the column roles of a <span class="in">`Task`</span>:</span>
<span id="cb129-284"><a href="#cb129-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-285"><a href="#cb129-285" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Use the <span class="in">`r ref("Task")`</span> method <span class="in">`$set_col_roles()`</span> (recommended).</span>
<span id="cb129-286"><a href="#cb129-286" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Directly modify the field <span class="in">`$col_roles`</span>, which is a named list of vectors of column names.</span>
<span id="cb129-287"><a href="#cb129-287" aria-hidden="true" tabindex="-1"></a>   Each vector in this list corresponds to a column role, and the column names contained in that vector have the corresponding role.</span>
<span id="cb129-288"><a href="#cb129-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-289"><a href="#cb129-289" aria-hidden="true" tabindex="-1"></a>Just as <span class="in">`$select()`</span>/<span class="in">`$filter()`</span>, these are in-place operations, i.e. the task object itself is modified.</span>
<span id="cb129-290"><a href="#cb129-290" aria-hidden="true" tabindex="-1"></a>To retain an unmodified version of a task, use <span class="in">`$clone()`</span>.</span>
<span id="cb129-291"><a href="#cb129-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-292"><a href="#cb129-292" aria-hidden="true" tabindex="-1"></a>Changing the column or row roles, whether through <span class="in">`$select()`</span>/<span class="in">`$filter()`</span> or directly, does not change the underlying data, it just updates the view on it.</span>
<span id="cb129-293"><a href="#cb129-293" aria-hidden="true" tabindex="-1"></a>Because the underlying data are still there (and accessible through <span class="in">`$backend`</span>), we can add the <span class="in">`"cyl"`</span> column back into the task by setting its column role to <span class="in">`"feature"`</span>.</span>
<span id="cb129-294"><a href="#cb129-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-295"><a href="#cb129-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-021}</span></span>
<span id="cb129-296"><a href="#cb129-296" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">set_col_roles</span>(<span class="st">"cyl"</span>, <span class="at">roles =</span> <span class="st">"feature"</span>)</span>
<span id="cb129-297"><a href="#cb129-297" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span>feature_names  <span class="co"># cyl is now a feature again</span></span>
<span id="cb129-298"><a href="#cb129-298" aria-hidden="true" tabindex="-1"></a>task_mtcars_small<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb129-299"><a href="#cb129-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-300"><a href="#cb129-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-301"><a href="#cb129-301" aria-hidden="true" tabindex="-1"></a>Just like columns, it is also possible to assign different roles to rows.</span>
<span id="cb129-302"><a href="#cb129-302" aria-hidden="true" tabindex="-1"></a>Rows can have two different roles:</span>
<span id="cb129-303"><a href="#cb129-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-304"><a href="#cb129-304" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Role <span class="in">`use`</span>:</span>
<span id="cb129-305"><a href="#cb129-305" aria-hidden="true" tabindex="-1"></a>  Rows that are generally available for training (although they may also be used for the test set).</span>
<span id="cb129-306"><a href="#cb129-306" aria-hidden="true" tabindex="-1"></a>  This role is the default role.</span>
<span id="cb129-307"><a href="#cb129-307" aria-hidden="true" tabindex="-1"></a>  The <span class="in">`$filter()`</span> call changes this role, in the same way that <span class="in">`$select()`</span> changes the <span class="in">`"feature"`</span> column role.</span>
<span id="cb129-308"><a href="#cb129-308" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Role <span class="in">`validation`</span>:</span>
<span id="cb129-309"><a href="#cb129-309" aria-hidden="true" tabindex="-1"></a>  Rows that are not used for training.</span>
<span id="cb129-310"><a href="#cb129-310" aria-hidden="true" tabindex="-1"></a>  Rows that have missing values in the target column during task creation are automatically set to the validation role.</span>
<span id="cb129-311"><a href="#cb129-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-312"><a href="#cb129-312" aria-hidden="true" tabindex="-1"></a>There are several reasons to hold some observations back or treat them differently:</span>
<span id="cb129-313"><a href="#cb129-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-314"><a href="#cb129-314" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>It is often good practice to validate the final model on an external validation set to identify overfitting.</span>
<span id="cb129-315"><a href="#cb129-315" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Some observations may be unlabeled in the original data, e.g. in competitions like <span class="in">`r link("https://www.kaggle.com/", "Kaggle")`</span>.</span>
<span id="cb129-316"><a href="#cb129-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-317"><a href="#cb129-317" aria-hidden="true" tabindex="-1"></a>These observations cannot be used for training a model, but can be used for getting predictions from a trained model.</span>
<span id="cb129-318"><a href="#cb129-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-319"><a href="#cb129-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-320"><a href="#cb129-320" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learners {#sec-learners}</span></span>
<span id="cb129-321"><a href="#cb129-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-322"><a href="#cb129-322" aria-hidden="true" tabindex="-1"></a>Objects of class <span class="in">`r ref("Learner")`</span> provide a unified interface to many popular machine learning algorithms in R.</span>
<span id="cb129-323"><a href="#cb129-323" aria-hidden="true" tabindex="-1"></a>They are available through the <span class="in">`mlr_learners`</span> dictionary.</span>
<span id="cb129-324"><a href="#cb129-324" aria-hidden="true" tabindex="-1"></a>The list of learners supported in the base package <span class="in">`r mlr3`</span> is deliberately small to avoid dependencies; support for additional learners is provided by the <span class="in">`r mlr3learners`</span> and <span class="in">`r mlr3extralearners`</span> packages.</span>
<span id="cb129-325"><a href="#cb129-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-326"><a href="#cb129-326" aria-hidden="true" tabindex="-1"></a>Learners encapsulate methods to train a model and make predictions using it given a <span class="in">`r ref("Task")`</span> and provide meta-data about the learners.</span>
<span id="cb129-327"><a href="#cb129-327" aria-hidden="true" tabindex="-1"></a>The base class of each learner is <span class="in">`r ref("Learner")`</span>.</span>
<span id="cb129-328"><a href="#cb129-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-329"><a href="#cb129-329" aria-hidden="true" tabindex="-1"></a>To retrieve a <span class="in">`r ref("Learner")`</span> from the <span class="in">`mlr_learners`</span> dictionary, use the function <span class="in">`r ref("lrn()")`</span>:</span>
<span id="cb129-330"><a href="#cb129-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-331"><a href="#cb129-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-023}</span></span>
<span id="cb129-332"><a href="#cb129-332" aria-hidden="true" tabindex="-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb129-333"><a href="#cb129-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-334"><a href="#cb129-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-335"><a href="#cb129-335" aria-hidden="true" tabindex="-1"></a>Each learner provides the following meta-data:</span>
<span id="cb129-336"><a href="#cb129-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-337"><a href="#cb129-337" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$feature_types`</span>: the type of features the learner can deal with.</span>
<span id="cb129-338"><a href="#cb129-338" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$packages`</span>: the packages required to train a model with this learner and make predictions.</span>
<span id="cb129-339"><a href="#cb129-339" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$properties`</span>: additional properties and capabilities.</span>
<span id="cb129-340"><a href="#cb129-340" aria-hidden="true" tabindex="-1"></a>  For example, a learner has the property "missings" if it is able to handle missing feature values, and "importance" if it computes and allows to extract data on the relative importance of the features.</span>
<span id="cb129-341"><a href="#cb129-341" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$predict_types`</span>: possible prediction types.</span>
<span id="cb129-342"><a href="#cb129-342" aria-hidden="true" tabindex="-1"></a>  For example, a regression learner can predict numerical values ("response") and may be able to predict the standard error of a prediction ("se").</span>
<span id="cb129-343"><a href="#cb129-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-344"><a href="#cb129-344" aria-hidden="true" tabindex="-1"></a>This information can be queried through these slots, or seen at a glance when printing the learner:</span>
<span id="cb129-345"><a href="#cb129-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-024}</span></span>
<span id="cb129-346"><a href="#cb129-346" aria-hidden="true" tabindex="-1"></a>learner_rpart</span>
<span id="cb129-347"><a href="#cb129-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-348"><a href="#cb129-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-349"><a href="#cb129-349" aria-hidden="true" tabindex="-1"></a>All learners work in two stages:</span>
<span id="cb129-350"><a href="#cb129-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-351"><a href="#cb129-351" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Training**: A training task (features and target data) is passed to the learner's <span class="in">`$train()`</span> function which trains and stores a model, i.e. the learned relationship of the features to the target.</span>
<span id="cb129-352"><a href="#cb129-352" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Prediction**: New data, usually a different partition of the original dataset, is passed to the <span class="in">`$predict()`</span> method of the trained learner.</span>
<span id="cb129-353"><a href="#cb129-353" aria-hidden="true" tabindex="-1"></a>  The model trained in the first step is used to predict the target values, e.g. the numerical value for regression problems.</span>
<span id="cb129-354"><a href="#cb129-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-355"><a href="#cb129-355" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb129-356"><a href="#cb129-356" aria-hidden="true" tabindex="-1"></a>A learner that has not been trained cannot make predictions and will throw an error if <span class="in">`$predict()`</span> is called on it.</span>
<span id="cb129-357"><a href="#cb129-357" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-358"><a href="#cb129-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-359"><a href="#cb129-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-022, echo=FALSE, fig.align="center"}</span></span>
<span id="cb129-360"><a href="#cb129-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-basics-learner</span></span>
<span id="cb129-361"><a href="#cb129-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Overview of the different stages of a learner.</span></span>
<span id="cb129-362"><a href="#cb129-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Diagram showing the different stages of a learner, their interactions, and consumed data.</span></span>
<span id="cb129-363"><a href="#cb129-363" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/learner.svg"</span>)</span>
<span id="cb129-364"><a href="#cb129-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-365"><a href="#cb129-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-366"><a href="#cb129-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Training the learner {#sec-training}</span></span>
<span id="cb129-367"><a href="#cb129-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-368"><a href="#cb129-368" aria-hidden="true" tabindex="-1"></a>We train the model by giving a task to the learner.</span>
<span id="cb129-369"><a href="#cb129-369" aria-hidden="true" tabindex="-1"></a>It is a good idea to hold back some data from the training process use to assess the quality of the predictions made by the trained model.</span>
<span id="cb129-370"><a href="#cb129-370" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("partition()")`</span> function randomly splits the task into two disjoint sets: a training set (67% of the total data, the default) and a test set (33% of the total data, the data not part of the training set).</span>
<span id="cb129-371"><a href="#cb129-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-372"><a href="#cb129-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-025}</span></span>
<span id="cb129-373"><a href="#cb129-373" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_mtcars)</span>
<span id="cb129-374"><a href="#cb129-374" aria-hidden="true" tabindex="-1"></a>splits</span>
<span id="cb129-375"><a href="#cb129-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-376"><a href="#cb129-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-377"><a href="#cb129-377" aria-hidden="true" tabindex="-1"></a>We learn a regression tree by calling the <span class="in">`$train()`</span> method of the learner, specifying the task and the part of it to use for training (<span class="in">`splits$train`</span>).</span>
<span id="cb129-378"><a href="#cb129-378" aria-hidden="true" tabindex="-1"></a>This operation adds the learned model to the existing <span class="in">`r ref("Learner")`</span> object.</span>
<span id="cb129-379"><a href="#cb129-379" aria-hidden="true" tabindex="-1"></a>We can now access the stored model via the field <span class="in">`$model`</span>.</span>
<span id="cb129-380"><a href="#cb129-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-381"><a href="#cb129-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-025-1}</span></span>
<span id="cb129-382"><a href="#cb129-382" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb129-383"><a href="#cb129-383" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>model</span>
<span id="cb129-384"><a href="#cb129-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-385"><a href="#cb129-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-386"><a href="#cb129-386" aria-hidden="true" tabindex="-1"></a>We see that the learner has identified features in the task that are predictive of the class (<span class="in">`mpg`</span>) and uses them to partition observations in the tree.</span>
<span id="cb129-387"><a href="#cb129-387" aria-hidden="true" tabindex="-1"></a>The textual representation of the model depends on the type of learner.</span>
<span id="cb129-388"><a href="#cb129-388" aria-hidden="true" tabindex="-1"></a>For more information on this particular type of model and how it is printed, see <span class="in">`r ref ("rpart::print.rpart()")`</span>.</span>
<span id="cb129-389"><a href="#cb129-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-390"><a href="#cb129-390" aria-hidden="true" tabindex="-1"></a>The model seems rather simplistic, using only a single feature and a single set of branches.</span>
<span id="cb129-391"><a href="#cb129-391" aria-hidden="true" tabindex="-1"></a>Each learner has hyperparameters that control its behavior and allow to influence the way a model is learned.</span>
<span id="cb129-392"><a href="#cb129-392" aria-hidden="true" tabindex="-1"></a>Setting hyperparameters to values appropriate for a given machine learning task is crucial for good predictive performance.</span>
<span id="cb129-393"><a href="#cb129-393" aria-hidden="true" tabindex="-1"></a>The field <span class="in">`param_set`</span> stores a description of the hyperparameters the learner has, their ranges, defaults, and current values:</span>
<span id="cb129-394"><a href="#cb129-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-395"><a href="#cb129-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-026}</span></span>
<span id="cb129-396"><a href="#cb129-396" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>param_set</span>
<span id="cb129-397"><a href="#cb129-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-398"><a href="#cb129-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-399"><a href="#cb129-399" aria-hidden="true" tabindex="-1"></a>The set of current hyperparameter values is stored in the <span class="in">`values`</span> field of the <span class="in">`param_set`</span> field.</span>
<span id="cb129-400"><a href="#cb129-400" aria-hidden="true" tabindex="-1"></a>You can access and change the current hyperparameter values by accessing this field, which stores a named list:</span>
<span id="cb129-401"><a href="#cb129-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-402"><a href="#cb129-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-027}</span></span>
<span id="cb129-403"><a href="#cb129-403" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb129-404"><a href="#cb129-404" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>minsplit <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb129-405"><a href="#cb129-405" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb129-406"><a href="#cb129-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-407"><a href="#cb129-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-408"><a href="#cb129-408" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-409"><a href="#cb129-409" aria-hidden="true" tabindex="-1"></a>It is possible to assign all hyperparameters in one go by assigning a named list to <span class="in">`$values`</span>: <span class="in">`learner$param_set$values = list(minsplit = 10, ...)`</span>.</span>
<span id="cb129-410"><a href="#cb129-410" aria-hidden="true" tabindex="-1"></a>This operation removes all previously-set hyperparameters.</span>
<span id="cb129-411"><a href="#cb129-411" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-412"><a href="#cb129-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-413"><a href="#cb129-413" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("lrn()")`</span> function also accepts additional arguments to update hyperparameters or set fields of the learner when constructing it:</span>
<span id="cb129-414"><a href="#cb129-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-415"><a href="#cb129-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-028}</span></span>
<span id="cb129-416"><a href="#cb129-416" aria-hidden="true" tabindex="-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb129-417"><a href="#cb129-417" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb129-418"><a href="#cb129-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-419"><a href="#cb129-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-420"><a href="#cb129-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-029}</span></span>
<span id="cb129-421"><a href="#cb129-421" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb129-422"><a href="#cb129-422" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>model</span>
<span id="cb129-423"><a href="#cb129-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-424"><a href="#cb129-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-425"><a href="#cb129-425" aria-hidden="true" tabindex="-1"></a>With the changed hyperparameters, we have a more complex (and more reasonable) model.</span>
<span id="cb129-426"><a href="#cb129-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-427"><a href="#cb129-427" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb129-428"><a href="#cb129-428" aria-hidden="true" tabindex="-1"></a>Details on the hyperparameters of our <span class="in">`rpart`</span> learner can be found at <span class="in">`r ref ("rpart::rpart.control()")`</span>.</span>
<span id="cb129-429"><a href="#cb129-429" aria-hidden="true" tabindex="-1"></a>Hyperparameters in general are discussed in more detail in the section on <span class="co">[</span><span class="ot">Hyperparameter Tuning</span><span class="co">](#tuning)</span>.</span>
<span id="cb129-430"><a href="#cb129-430" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-431"><a href="#cb129-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-432"><a href="#cb129-432" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predicting {#sec-predicting}</span></span>
<span id="cb129-433"><a href="#cb129-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-434"><a href="#cb129-434" aria-hidden="true" tabindex="-1"></a>After the model has been created, we can now use it to make predictions.</span>
<span id="cb129-435"><a href="#cb129-435" aria-hidden="true" tabindex="-1"></a>We can give the test partition to the <span class="in">`$predict()`</span> function:</span>
<span id="cb129-436"><a href="#cb129-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-437"><a href="#cb129-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-030}</span></span>
<span id="cb129-438"><a href="#cb129-438" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb129-439"><a href="#cb129-439" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-440"><a href="#cb129-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-441"><a href="#cb129-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-442"><a href="#cb129-442" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$predict()`</span> method returns a <span class="in">`r ref("Prediction")`</span> object, in this case a <span class="in">`r ref("PredictionRegr")`</span> for predicting a numeric quantity.</span>
<span id="cb129-443"><a href="#cb129-443" aria-hidden="true" tabindex="-1"></a>The "truth" column contains the ground truth data, which was not given to the model to get a prediction.</span>
<span id="cb129-444"><a href="#cb129-444" aria-hidden="true" tabindex="-1"></a>The "response" column contains the value predicted by the model, allowing for easy comparison with the ground truth data.</span>
<span id="cb129-445"><a href="#cb129-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-446"><a href="#cb129-446" aria-hidden="true" tabindex="-1"></a>We can also use separate data to make predictions, which can be part of a separate task or simply a separate <span class="in">`data.frame`</span>:</span>
<span id="cb129-447"><a href="#cb129-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-448"><a href="#cb129-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-031}</span></span>
<span id="cb129-449"><a href="#cb129-449" aria-hidden="true" tabindex="-1"></a>mtcars_new <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">cyl =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb129-450"><a href="#cb129-450" aria-hidden="true" tabindex="-1"></a>                        <span class="at">disp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb129-451"><a href="#cb129-451" aria-hidden="true" tabindex="-1"></a>                        <span class="at">hp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>),</span>
<span id="cb129-452"><a href="#cb129-452" aria-hidden="true" tabindex="-1"></a>                        <span class="at">drat =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">3.9</span>),</span>
<span id="cb129-453"><a href="#cb129-453" aria-hidden="true" tabindex="-1"></a>                        <span class="at">wt =</span> <span class="fu">c</span>(<span class="fl">3.8</span>, <span class="fl">4.1</span>),</span>
<span id="cb129-454"><a href="#cb129-454" aria-hidden="true" tabindex="-1"></a>                        <span class="at">qsec =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="fl">19.5</span>),</span>
<span id="cb129-455"><a href="#cb129-455" aria-hidden="true" tabindex="-1"></a>                        <span class="at">vs =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb129-456"><a href="#cb129-456" aria-hidden="true" tabindex="-1"></a>                        <span class="at">am =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb129-457"><a href="#cb129-457" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gear =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">4</span>),</span>
<span id="cb129-458"><a href="#cb129-458" aria-hidden="true" tabindex="-1"></a>                        <span class="at">carb =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb129-459"><a href="#cb129-459" aria-hidden="true" tabindex="-1"></a>mtcars_new</span>
<span id="cb129-460"><a href="#cb129-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-461"><a href="#cb129-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-462"><a href="#cb129-462" aria-hidden="true" tabindex="-1"></a>The learner does not need to know more meta-data about this data to make predictions, as this was given when training the model.</span>
<span id="cb129-463"><a href="#cb129-463" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`$predict_newdata()`</span> method to make predictions for our separate dataset:</span>
<span id="cb129-464"><a href="#cb129-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-465"><a href="#cb129-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-032}</span></span>
<span id="cb129-466"><a href="#cb129-466" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict_newdata</span>(mtcars_new)</span>
<span id="cb129-467"><a href="#cb129-467" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-468"><a href="#cb129-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-469"><a href="#cb129-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-470"><a href="#cb129-470" aria-hidden="true" tabindex="-1"></a>Note that the "truth" column is now <span class="in">`NA`</span>, as we did not give the ground truth data.</span>
<span id="cb129-471"><a href="#cb129-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-472"><a href="#cb129-472" aria-hidden="true" tabindex="-1"></a>We can also access the predictions directly:</span>
<span id="cb129-473"><a href="#cb129-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-474"><a href="#cb129-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-access-pred}</span></span>
<span id="cb129-475"><a href="#cb129-475" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span>response</span>
<span id="cb129-476"><a href="#cb129-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-477"><a href="#cb129-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-478"><a href="#cb129-478" aria-hidden="true" tabindex="-1"></a>Similar to plotting tasks, <span class="in">`r mlr3viz`</span> provides an <span class="in">`r ref("ggplot2::autoplot()", text = "autoplot()")`</span> method for <span class="in">`r ref("Prediction")`</span> objects.</span>
<span id="cb129-479"><a href="#cb129-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-480"><a href="#cb129-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-035, message = FALSE, warning = FALSE}</span></span>
<span id="cb129-481"><a href="#cb129-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the mtcars dataset."</span></span>
<span id="cb129-482"><a href="#cb129-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A scatter plot of predicted values on one axis and ground truth values on the other. A trend line is fit to show that in general there is good agreement between predicted and ground truth values."</span></span>
<span id="cb129-483"><a href="#cb129-483" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb129-484"><a href="#cb129-484" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb129-485"><a href="#cb129-485" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(predictions)</span>
<span id="cb129-486"><a href="#cb129-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-487"><a href="#cb129-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-488"><a href="#cb129-488" aria-hidden="true" tabindex="-1"></a><span class="fu">### Changing the Prediction Type {#sec-predict-type}</span></span>
<span id="cb129-489"><a href="#cb129-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-490"><a href="#cb129-490" aria-hidden="true" tabindex="-1"></a>Regression learners default to predicting a numeric quantity.</span>
<span id="cb129-491"><a href="#cb129-491" aria-hidden="true" tabindex="-1"></a>However, many regression models can also give you bounds on the prediction by providing the standard error.</span>
<span id="cb129-492"><a href="#cb129-492" aria-hidden="true" tabindex="-1"></a>To predict these standard errors, the <span class="in">`predict_type`</span> field of a <span class="in">`r ref("LearnerRegr")`</span> must be changed from "response" (the default) to "se" before training.</span>
<span id="cb129-493"><a href="#cb129-493" aria-hidden="true" tabindex="-1"></a>The <span class="in">`rpart`</span> learner we used above does not support predicting standard errors, so we use the <span class="in">`lm`</span> linear model instead, from the <span class="in">`r ref("mlr3learners")`</span> package:</span>
<span id="cb129-494"><a href="#cb129-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-495"><a href="#cb129-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-033}</span></span>
<span id="cb129-496"><a href="#cb129-496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb129-497"><a href="#cb129-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-498"><a href="#cb129-498" aria-hidden="true" tabindex="-1"></a>learner_lm <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.lm"</span>)</span>
<span id="cb129-499"><a href="#cb129-499" aria-hidden="true" tabindex="-1"></a>learner_lm<span class="sc">$</span>predict_type <span class="ot">=</span> <span class="st">"se"</span></span>
<span id="cb129-500"><a href="#cb129-500" aria-hidden="true" tabindex="-1"></a>learner_lm<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb129-501"><a href="#cb129-501" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_lm<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb129-502"><a href="#cb129-502" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-503"><a href="#cb129-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-504"><a href="#cb129-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-505"><a href="#cb129-505" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-506"><a href="#cb129-506" aria-hidden="true" tabindex="-1"></a>@sec-lrns-add-list shows how to list learners that support the standard error prediction type.</span>
<span id="cb129-507"><a href="#cb129-507" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-508"><a href="#cb129-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-509"><a href="#cb129-509" aria-hidden="true" tabindex="-1"></a>The prediction object now contains the standard error for the predictions.</span>
<span id="cb129-510"><a href="#cb129-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-511"><a href="#cb129-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-034}</span></span>
<span id="cb129-512"><a href="#cb129-512" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-513"><a href="#cb129-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-514"><a href="#cb129-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-515"><a href="#cb129-515" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluation {#sec-eval}</span></span>
<span id="cb129-516"><a href="#cb129-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-517"><a href="#cb129-517" aria-hidden="true" tabindex="-1"></a>An important step of modeling is evaluating the performance of the trained model.</span>
<span id="cb129-518"><a href="#cb129-518" aria-hidden="true" tabindex="-1"></a>We have seen how to inspect the model and plot its predictions above, but a more rigorous way that allows to compare different types of models more easily is to compute a performance measure.</span>
<span id="cb129-519"><a href="#cb129-519" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> offers many performance measures, which can be created with the <span class="in">`r ref("msr()")`</span> function.</span>
<span id="cb129-520"><a href="#cb129-520" aria-hidden="true" tabindex="-1"></a>Measures are stored in the dictionary <span class="in">`r ref("mlr_measures")`</span>, and a measure has to be supported by <span class="in">`r mlr3`</span> to be used, just like learners.</span>
<span id="cb129-521"><a href="#cb129-521" aria-hidden="true" tabindex="-1"></a>For example, we can list all measures that are available for regression tasks:</span>
<span id="cb129-522"><a href="#cb129-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-523"><a href="#cb129-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-036}</span></span>
<span id="cb129-524"><a href="#cb129-524" aria-hidden="true" tabindex="-1"></a>mlr_measures<span class="sc">$</span><span class="fu">keys</span>(<span class="st">"regr"</span>)</span>
<span id="cb129-525"><a href="#cb129-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-526"><a href="#cb129-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-527"><a href="#cb129-527" aria-hidden="true" tabindex="-1"></a>Measure objects can be created with a single performance measure (<span class="in">`r ref("msr()")`</span>) or multiple (<span class="in">`r ref("msrs()")`</span>):</span>
<span id="cb129-528"><a href="#cb129-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-529"><a href="#cb129-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-037}</span></span>
<span id="cb129-530"><a href="#cb129-530" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.rmse"</span>)</span>
<span id="cb129-531"><a href="#cb129-531" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.rmse"</span>, <span class="st">"regr.sse"</span>))</span>
<span id="cb129-532"><a href="#cb129-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-533"><a href="#cb129-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-534"><a href="#cb129-534" aria-hidden="true" tabindex="-1"></a>At the core of all performance measures is a quantification of the difference between the predicted value and the ground truth value (except for unsupervised tasks, which we will discuss later).</span>
<span id="cb129-535"><a href="#cb129-535" aria-hidden="true" tabindex="-1"></a>This means that in order to assess performance, we usually need the ground truth data -- observations for which we do not know the true value cannot be used to assess the quality of the predictions of a model.</span>
<span id="cb129-536"><a href="#cb129-536" aria-hidden="true" tabindex="-1"></a>This is why we make predictions on the data the model did not use during training (the test set).</span>
<span id="cb129-537"><a href="#cb129-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-538"><a href="#cb129-538" aria-hidden="true" tabindex="-1"></a>As we have seen above, <span class="in">`r mlr3`</span>'s <span class="in">`r ref("Prediction")`</span> objects contain both predictions and ground truth.</span>
<span id="cb129-539"><a href="#cb129-539" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("Measure")`</span> objects define how prediction and ground truth are compared, and how differences between them are quantified.</span>
<span id="cb129-540"><a href="#cb129-540" aria-hidden="true" tabindex="-1"></a>We choose root mean squared error (<span class="in">`r ref("mlr_measures_regr.rmse", text = "regr.rmse")`</span>) as our performance measure for this example.</span>
<span id="cb129-541"><a href="#cb129-541" aria-hidden="true" tabindex="-1"></a>Once the measure is created, we can pass it to the <span class="in">`$score()`</span> method of the <span class="in">`r ref("Prediction")`</span> object to quantify the predictive performance of our model.</span>
<span id="cb129-542"><a href="#cb129-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-543"><a href="#cb129-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-038}</span></span>
<span id="cb129-544"><a href="#cb129-544" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.rmse"</span>)</span>
<span id="cb129-545"><a href="#cb129-545" aria-hidden="true" tabindex="-1"></a>measure</span>
<span id="cb129-546"><a href="#cb129-546" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure)</span>
<span id="cb129-547"><a href="#cb129-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-548"><a href="#cb129-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-549"><a href="#cb129-549" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb129-550"><a href="#cb129-550" aria-hidden="true" tabindex="-1"></a><span class="in">`$score()`</span> can be called without a measure; in this case the default measure for the type of task is used.</span>
<span id="cb129-551"><a href="#cb129-551" aria-hidden="true" tabindex="-1"></a>Regression defaults to mean squared error (<span class="in">`r ref("mlr_measures_regr.mse", text = "regr.mse")`</span>).</span>
<span id="cb129-552"><a href="#cb129-552" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-553"><a href="#cb129-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-554"><a href="#cb129-554" aria-hidden="true" tabindex="-1"></a>It is possible to calculate multiple measures at the same time by passing multiple measures to <span class="in">`$score()`</span>.</span>
<span id="cb129-555"><a href="#cb129-555" aria-hidden="true" tabindex="-1"></a>For example, to compute both root mean squared error <span class="in">`r ref("mlr_measures_regr.rmse", text = "regr.rmse")`</span> and mean squared error <span class="in">`r ref("mlr_measures_regr.mse", text = "regr.mse")`</span>:</span>
<span id="cb129-556"><a href="#cb129-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-557"><a href="#cb129-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-039}</span></span>
<span id="cb129-558"><a href="#cb129-558" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.rmse"</span>, <span class="st">"regr.mse"</span>))</span>
<span id="cb129-559"><a href="#cb129-559" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measures)</span>
<span id="cb129-560"><a href="#cb129-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-561"><a href="#cb129-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-562"><a href="#cb129-562" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> also provides measures that do not quantify the quality of the predictions of a model, but other information we may be interested in, for example the time it took to train the model and make predictions:</span>
<span id="cb129-563"><a href="#cb129-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-564"><a href="#cb129-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-measures-time}</span></span>
<span id="cb129-565"><a href="#cb129-565" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"time_train"</span>, <span class="st">"time_predict"</span>))</span>
<span id="cb129-566"><a href="#cb129-566" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measures, <span class="at">learner =</span> learner_lm)</span>
<span id="cb129-567"><a href="#cb129-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-568"><a href="#cb129-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-569"><a href="#cb129-569" aria-hidden="true" tabindex="-1"></a>Note that these measures require a trained learner in addition to the predictions.</span>
<span id="cb129-570"><a href="#cb129-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-571"><a href="#cb129-571" aria-hidden="true" tabindex="-1"></a>Some measures have hyperparameters themselves, for example <span class="in">`r ref("mlr_measures_selected_features", text = "selected_features")`</span>.</span>
<span id="cb129-572"><a href="#cb129-572" aria-hidden="true" tabindex="-1"></a>This measure gives information on the features the model used and is only supported by learners that have the "selected_features" property.</span>
<span id="cb129-573"><a href="#cb129-573" aria-hidden="true" tabindex="-1"></a>It requires a task and a learner in addition to the predictions.</span>
<span id="cb129-574"><a href="#cb129-574" aria-hidden="true" tabindex="-1"></a>The <span class="in">`lm`</span> model does not support showing selected features; we use the <span class="in">`rpart`</span> learner again and the full <span class="in">`mtcars`</span> task.</span>
<span id="cb129-575"><a href="#cb129-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-576"><a href="#cb129-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-measures-hp}</span></span>
<span id="cb129-577"><a href="#cb129-577" aria-hidden="true" tabindex="-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb129-578"><a href="#cb129-578" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_mtcars)</span>
<span id="cb129-579"><a href="#cb129-579" aria-hidden="true" tabindex="-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">minsplit =</span> <span class="dv">10</span>)</span>
<span id="cb129-580"><a href="#cb129-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-581"><a href="#cb129-581" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb129-582"><a href="#cb129-582" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb129-583"><a href="#cb129-583" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>)</span>
<span id="cb129-584"><a href="#cb129-584" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure, <span class="at">task =</span> task_mtcars, <span class="at">learner =</span> learner_rpart)</span>
<span id="cb129-585"><a href="#cb129-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-586"><a href="#cb129-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-587"><a href="#cb129-587" aria-hidden="true" tabindex="-1"></a>The hyperparameter of the measure specifies whether the number of selected features should be normalized by the total number of features.</span>
<span id="cb129-588"><a href="#cb129-588" aria-hidden="true" tabindex="-1"></a>The default is <span class="in">`FALSE`</span>, giving the absolute number of features that, in this case, the trained decision tree uses.</span>
<span id="cb129-589"><a href="#cb129-589" aria-hidden="true" tabindex="-1"></a>We can change the hyperparameter in the same way as for learners, for example:</span>
<span id="cb129-590"><a href="#cb129-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-591"><a href="#cb129-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-measures-hp-set}</span></span>
<span id="cb129-592"><a href="#cb129-592" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>, <span class="at">normalize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-593"><a href="#cb129-593" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure, <span class="at">task =</span> task_mtcars, <span class="at">learner =</span> learner_rpart)</span>
<span id="cb129-594"><a href="#cb129-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-595"><a href="#cb129-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-596"><a href="#cb129-596" aria-hidden="true" tabindex="-1"></a>We have now seen the basic building blocks of <span class="in">`r mlr3`</span> -- creating and partitioning a task, instantiating a learner and setting its hyperparameters, training a model and inspecting it, making predictions, and assessing the quality of the model with a performance measure.</span>
<span id="cb129-597"><a href="#cb129-597" aria-hidden="true" tabindex="-1"></a>So far, we have focused on regression, where we want to predict a numeric quantity.</span>
<span id="cb129-598"><a href="#cb129-598" aria-hidden="true" tabindex="-1"></a>The rest of this chapter looks at other task types.</span>
<span id="cb129-599"><a href="#cb129-599" aria-hidden="true" tabindex="-1"></a>The general procedure it the same, but some details are different.</span>
<span id="cb129-600"><a href="#cb129-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-601"><a href="#cb129-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-602"><a href="#cb129-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification {#sec-classif}</span></span>
<span id="cb129-603"><a href="#cb129-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-604"><a href="#cb129-604" aria-hidden="true" tabindex="-1"></a>Classification predicts a discrete, categorical target instead of the continuous numeric quantity for regression.</span>
<span id="cb129-605"><a href="#cb129-605" aria-hidden="true" tabindex="-1"></a>The models that learn to classify data are different from regression models, and regression learners are not applicable for classification problems (although for some learners, there are both regression and classification versions).</span>
<span id="cb129-606"><a href="#cb129-606" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> distinguishes between the different tasks and learner types through different R6 classes and different prefixes -- regression learners and measures start with <span class="in">`regr.`</span>, whereas classification learners and measures start with <span class="in">`classif.`</span>.</span>
<span id="cb129-607"><a href="#cb129-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-608"><a href="#cb129-608" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classification Tasks {#sec-classif-tsks}</span></span>
<span id="cb129-609"><a href="#cb129-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-610"><a href="#cb129-610" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("mlr_tasks")`</span> dictionary that comes with <span class="in">`r mlr3`</span> contains several classification tasks (<span class="in">`r ref("TaskClassif")`</span>).</span>
<span id="cb129-611"><a href="#cb129-611" aria-hidden="true" tabindex="-1"></a>We can show only the classification tasks by converting the dictionary to a <span class="in">`data.table`</span> and filtering on the <span class="in">`task_type`</span>:</span>
<span id="cb129-612"><a href="#cb129-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-613"><a href="#cb129-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-040}</span></span>
<span id="cb129-614"><a href="#cb129-614" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_tasks)[task_type <span class="sc">==</span> <span class="st">"classif"</span>]</span>
<span id="cb129-615"><a href="#cb129-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-616"><a href="#cb129-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-617"><a href="#cb129-617" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`r ref("datasets::penguins", text = "penguins")`</span> dataset as a running example:</span>
<span id="cb129-618"><a href="#cb129-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-619"><a href="#cb129-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-041}</span></span>
<span id="cb129-620"><a href="#cb129-620" aria-hidden="true" tabindex="-1"></a>task_penguins <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>)</span>
<span id="cb129-621"><a href="#cb129-621" aria-hidden="true" tabindex="-1"></a>task_penguins</span>
<span id="cb129-622"><a href="#cb129-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-623"><a href="#cb129-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-624"><a href="#cb129-624" aria-hidden="true" tabindex="-1"></a>Just like for regression tasks, printing it gives an overview of the task, including the number of observations and features, and their types.</span>
<span id="cb129-625"><a href="#cb129-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-626"><a href="#cb129-626" aria-hidden="true" tabindex="-1"></a>The target variable, <span class="in">`r task_penguins$target_names`</span>, is of type factor and has the following three classes or levels:</span>
<span id="cb129-627"><a href="#cb129-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-628"><a href="#cb129-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-042}</span></span>
<span id="cb129-629"><a href="#cb129-629" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(task_penguins<span class="sc">$</span><span class="fu">data</span>(<span class="at">cols =</span> <span class="st">"species"</span>))</span>
<span id="cb129-630"><a href="#cb129-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-631"><a href="#cb129-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-632"><a href="#cb129-632" aria-hidden="true" tabindex="-1"></a>Classification tasks (<span class="in">`r ref("TaskClassif")`</span>) can also be plotted using <span class="in">`r ref("ggplot2::autoplot()", text = "autoplot()")`</span>.</span>
<span id="cb129-633"><a href="#cb129-633" aria-hidden="true" tabindex="-1"></a>Apart from the "pairs" plot type that we show here, "target" and "duo" are available.</span>
<span id="cb129-634"><a href="#cb129-634" aria-hidden="true" tabindex="-1"></a>We refer the interested reader to the documentation of <span class="in">`r ref("mlr3viz::autoplot.TaskClassif")`</span> for an explanation of the other options.</span>
<span id="cb129-635"><a href="#cb129-635" aria-hidden="true" tabindex="-1"></a>To keep the plot readable, we select only the first two features of the dataset.</span>
<span id="cb129-636"><a href="#cb129-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-637"><a href="#cb129-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-043, warning = FALSE, message = FALSE}</span></span>
<span id="cb129-638"><a href="#cb129-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Overview of the penguins dataset."</span></span>
<span id="cb129-639"><a href="#cb129-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Diagram showing the distribution of target and feature values in the penguins data.</span></span>
<span id="cb129-640"><a href="#cb129-640" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb129-641"><a href="#cb129-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-642"><a href="#cb129-642" aria-hidden="true" tabindex="-1"></a>task_penguins_small <span class="ot">=</span> task_penguins<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb129-643"><a href="#cb129-643" aria-hidden="true" tabindex="-1"></a>task_penguins_small<span class="sc">$</span><span class="fu">select</span>(<span class="fu">head</span>(task_penguins_small<span class="sc">$</span>feature_names, <span class="dv">2</span>))</span>
<span id="cb129-644"><a href="#cb129-644" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(task_penguins_small, <span class="at">type =</span> <span class="st">"pairs"</span>)</span>
<span id="cb129-645"><a href="#cb129-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-646"><a href="#cb129-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-647"><a href="#cb129-647" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classification Learners {#sec-classif-lrns}</span></span>
<span id="cb129-648"><a href="#cb129-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-649"><a href="#cb129-649" aria-hidden="true" tabindex="-1"></a>Classification learners (<span class="in">`r ref("LearnerClassif")`</span>) are a different R6 class than regression learners (<span class="in">`r ref("LearnerRegr")`</span>), but also inherit from the base class <span class="in">`r ref("Learner")`</span>.</span>
<span id="cb129-650"><a href="#cb129-650" aria-hidden="true" tabindex="-1"></a>We can instantiate a classification learner in the same way as a regression learner, by retrieving it from the <span class="in">`mlr_learners`</span> dictionary using <span class="in">`r ref("lrn()")`</span>.</span>
<span id="cb129-651"><a href="#cb129-651" aria-hidden="true" tabindex="-1"></a>Note the <span class="in">`classif.`</span> prefix to denote that we want a learner that classifies observations:</span>
<span id="cb129-652"><a href="#cb129-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-653"><a href="#cb129-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-044}</span></span>
<span id="cb129-654"><a href="#cb129-654" aria-hidden="true" tabindex="-1"></a>learner_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb129-655"><a href="#cb129-655" aria-hidden="true" tabindex="-1"></a>learner_rpart</span>
<span id="cb129-656"><a href="#cb129-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-657"><a href="#cb129-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-658"><a href="#cb129-658" aria-hidden="true" tabindex="-1"></a>Just like regression learners, classification learners have hyperparameters we can set to change their behavior, and printing the learner object gives some basic information about it.</span>
<span id="cb129-659"><a href="#cb129-659" aria-hidden="true" tabindex="-1"></a>Training a model and making predictions works in the same way as for regression:</span>
<span id="cb129-660"><a href="#cb129-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-661"><a href="#cb129-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-classification-train-predict}</span></span>
<span id="cb129-662"><a href="#cb129-662" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_penguins)</span>
<span id="cb129-663"><a href="#cb129-663" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb129-664"><a href="#cb129-664" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>model</span>
<span id="cb129-665"><a href="#cb129-665" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_penguins, splits<span class="sc">$</span>test)</span>
<span id="cb129-666"><a href="#cb129-666" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-667"><a href="#cb129-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-668"><a href="#cb129-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-669"><a href="#cb129-669" aria-hidden="true" tabindex="-1"></a>Just like predictions of regression models, we can plot classification predictions with <span class="in">`r ref("ggplot2::autoplot()", text = "autoplot()")`</span>:</span>
<span id="cb129-670"><a href="#cb129-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-671"><a href="#cb129-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-plot-pred-classif, message = FALSE, warning = FALSE}</span></span>
<span id="cb129-672"><a href="#cb129-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the penguins dataset."</span></span>
<span id="cb129-673"><a href="#cb129-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A stacked bar plot of predicted values in one bar and ground truth values in the other. The number of observations for a particular class is approximately, but not quite, the same for predicted and ground truth values."</span></span>
<span id="cb129-674"><a href="#cb129-674" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mlr3viz"</span>)</span>
<span id="cb129-675"><a href="#cb129-675" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(predictions)</span>
<span id="cb129-676"><a href="#cb129-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-677"><a href="#cb129-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-678"><a href="#cb129-678" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Changing the Prediction Type {#sec-classif-pred_type}</span></span>
<span id="cb129-679"><a href="#cb129-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-680"><a href="#cb129-680" aria-hidden="true" tabindex="-1"></a>Classification problems support two types of predictions: the default "response", i.e. the class label, and "prob", which gives the probability for each class label.</span>
<span id="cb129-681"><a href="#cb129-681" aria-hidden="true" tabindex="-1"></a>Not all learners support predicting probabilities.</span>
<span id="cb129-682"><a href="#cb129-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-683"><a href="#cb129-683" aria-hidden="true" tabindex="-1"></a>The prediction type for a learner can be changed by setting <span class="in">`$predict_type`</span>.</span>
<span id="cb129-684"><a href="#cb129-684" aria-hidden="true" tabindex="-1"></a>After retraining the learner, all predictions have class probabilities (one for each class) in addition to the response, which is the class with the highest probability:</span>
<span id="cb129-685"><a href="#cb129-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-686"><a href="#cb129-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-046}</span></span>
<span id="cb129-687"><a href="#cb129-687" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span>predict_type <span class="ot">=</span> <span class="st">"prob"</span></span>
<span id="cb129-688"><a href="#cb129-688" aria-hidden="true" tabindex="-1"></a>learner_rpart<span class="sc">$</span><span class="fu">train</span>(task_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb129-689"><a href="#cb129-689" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner_rpart<span class="sc">$</span><span class="fu">predict</span>(task_penguins, splits<span class="sc">$</span>test)</span>
<span id="cb129-690"><a href="#cb129-690" aria-hidden="true" tabindex="-1"></a>predictions</span>
<span id="cb129-691"><a href="#cb129-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-692"><a href="#cb129-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-693"><a href="#cb129-693" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-694"><a href="#cb129-694" aria-hidden="true" tabindex="-1"></a>@sec-lrns-add-list shows how to list learners that support the probability prediction type.</span>
<span id="cb129-695"><a href="#cb129-695" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-696"><a href="#cb129-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-697"><a href="#cb129-697" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classification Evaluation {#sec-classif-eval}</span></span>
<span id="cb129-698"><a href="#cb129-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-699"><a href="#cb129-699" aria-hidden="true" tabindex="-1"></a>Evaluation measures for classification problems that are supported by <span class="in">`r mlr3`</span> can be found in the <span class="in">`mlr_measures`</span> dictionary:</span>
<span id="cb129-700"><a href="#cb129-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-701"><a href="#cb129-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-047}</span></span>
<span id="cb129-702"><a href="#cb129-702" aria-hidden="true" tabindex="-1"></a>mlr_measures<span class="sc">$</span><span class="fu">keys</span>(<span class="st">"classif"</span>)</span>
<span id="cb129-703"><a href="#cb129-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-704"><a href="#cb129-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-705"><a href="#cb129-705" aria-hidden="true" tabindex="-1"></a>Some of these measures require the <span class="co">[</span><span class="ot">predictition type</span><span class="co">](#sec-classif-pred_type)</span> to be "prob" (e.g. <span class="in">`classif.auc`</span>).</span>
<span id="cb129-706"><a href="#cb129-706" aria-hidden="true" tabindex="-1"></a>As the default is "response", using those measures requires to change the prediction type, as shown above.</span>
<span id="cb129-707"><a href="#cb129-707" aria-hidden="true" tabindex="-1"></a>You can check what prediction type a measure requires by looking at <span class="in">`$predict_type`</span>.</span>
<span id="cb129-708"><a href="#cb129-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-709"><a href="#cb129-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-048}</span></span>
<span id="cb129-710"><a href="#cb129-710" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span>
<span id="cb129-711"><a href="#cb129-711" aria-hidden="true" tabindex="-1"></a>measure<span class="sc">$</span>predict_type</span>
<span id="cb129-712"><a href="#cb129-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-713"><a href="#cb129-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-714"><a href="#cb129-714" aria-hidden="true" tabindex="-1"></a>Once we have created a classification measure, we can give it to the <span class="in">`$score()`</span> method to compute its value for a given <span class="in">`r ref("PredictionClassif")`</span> object:</span>
<span id="cb129-715"><a href="#cb129-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-716"><a href="#cb129-716" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-classif-score}</span></span>
<span id="cb129-717"><a href="#cb129-717" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">score</span>(measure)</span>
<span id="cb129-718"><a href="#cb129-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-719"><a href="#cb129-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-720"><a href="#cb129-720" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Confusion Matrix</span></span>
<span id="cb129-721"><a href="#cb129-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-722"><a href="#cb129-722" aria-hidden="true" tabindex="-1"></a>A popular way to show the quality of prediction of a classification model is a confusion matrix.</span>
<span id="cb129-723"><a href="#cb129-723" aria-hidden="true" tabindex="-1"></a>It gives a quick overview of what observations are misclassified, and how they are misclassified.</span>
<span id="cb129-724"><a href="#cb129-724" aria-hidden="true" tabindex="-1"></a>The rows in a confusion matrix are the predicted class and the columns are the true class.</span>
<span id="cb129-725"><a href="#cb129-725" aria-hidden="true" tabindex="-1"></a>All off-diagonal entries are incorrectly classified observations, and all diagonal entries are correctly classified.</span>
<span id="cb129-726"><a href="#cb129-726" aria-hidden="true" tabindex="-1"></a>More information on <span class="in">`r link("https://en.wikipedia.org/wiki/Confusion_matrix", "Wikipedia")`</span>.</span>
<span id="cb129-727"><a href="#cb129-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-728"><a href="#cb129-728" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3`</span> supports confusion matrices through the <span class="in">`$confusion`</span> property of the <span class="in">`r ref("PredictionClassif")`</span> object:</span>
<span id="cb129-729"><a href="#cb129-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-730"><a href="#cb129-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-049}</span></span>
<span id="cb129-731"><a href="#cb129-731" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span>confusion</span>
<span id="cb129-732"><a href="#cb129-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-733"><a href="#cb129-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-734"><a href="#cb129-734" aria-hidden="true" tabindex="-1"></a>In this case, our classifier does fairly well classifying the penguins.</span>
<span id="cb129-735"><a href="#cb129-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-736"><a href="#cb129-736" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary Classification and Positive Classes {#sec-binary-classif}</span></span>
<span id="cb129-737"><a href="#cb129-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-738"><a href="#cb129-738" aria-hidden="true" tabindex="-1"></a>Classification problems with a two-class target are called binary classification tasks.</span>
<span id="cb129-739"><a href="#cb129-739" aria-hidden="true" tabindex="-1"></a>Binary Classification is special in the sense that one of these classes is denoted *positive* and the other one *negative*.</span>
<span id="cb129-740"><a href="#cb129-740" aria-hidden="true" tabindex="-1"></a>You can specify the *positive class* for a <span class="in">`r ref("TaskClassif", text = "classification task")`</span> object during task creation.</span>
<span id="cb129-741"><a href="#cb129-741" aria-hidden="true" tabindex="-1"></a>If not explicitly set during construction, the positive class defaults to the first level of the target feature.</span>
<span id="cb129-742"><a href="#cb129-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-743"><a href="#cb129-743" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-050}</span></span>
<span id="cb129-744"><a href="#cb129-744" aria-hidden="true" tabindex="-1"></a><span class="co"># during construction</span></span>
<span id="cb129-745"><a href="#cb129-745" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Sonar"</span>, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb129-746"><a href="#cb129-746" aria-hidden="true" tabindex="-1"></a>task_sonar <span class="ot">=</span> <span class="fu">as_task_classif</span>(Sonar, <span class="at">target =</span> <span class="st">"Class"</span>, <span class="at">positive =</span> <span class="st">"R"</span>)</span>
<span id="cb129-747"><a href="#cb129-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-748"><a href="#cb129-748" aria-hidden="true" tabindex="-1"></a><span class="co"># switch positive class to level 'M'</span></span>
<span id="cb129-749"><a href="#cb129-749" aria-hidden="true" tabindex="-1"></a>task_sonar<span class="sc">$</span>positive <span class="ot">=</span> <span class="st">"M"</span></span>
<span id="cb129-750"><a href="#cb129-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-751"><a href="#cb129-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-752"><a href="#cb129-752" aria-hidden="true" tabindex="-1"></a><span class="fu">### Thresholding {#sec-thresholding}</span></span>
<span id="cb129-753"><a href="#cb129-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-754"><a href="#cb129-754" aria-hidden="true" tabindex="-1"></a>Models trained on binary classification tasks that predict the probability for the positive class usually use a simple rule to determine the predicted class label -- if the probability is more than 50%, predict the positive label; otherwise, predict the negative label.</span>
<span id="cb129-755"><a href="#cb129-755" aria-hidden="true" tabindex="-1"></a>In some cases, you may want to adjust this threshold, for example, if the classes are very unbalanced (i.e., one is much more prevalent than the other).</span>
<span id="cb129-756"><a href="#cb129-756" aria-hidden="true" tabindex="-1"></a>For example, in the "german_credit" dataset, the credit risk is good for far more observations.</span>
<span id="cb129-757"><a href="#cb129-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-758"><a href="#cb129-758" aria-hidden="true" tabindex="-1"></a>Training a classifier on this data overpredicts the majority class, i.e. the more prevalent class is more likely to be predicted for any given observation.</span>
<span id="cb129-759"><a href="#cb129-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-760"><a href="#cb129-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-thresholding-1}</span></span>
<span id="cb129-761"><a href="#cb129-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the german_credit dataset."</span></span>
<span id="cb129-762"><a href="#cb129-762" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A stacked bar plot of predicted values in one bar and ground truth values in the other. The more prevalent class is predicted much more often than it is present in the ground truth data."</span></span>
<span id="cb129-763"><a href="#cb129-763" aria-hidden="true" tabindex="-1"></a>task_credit <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"german_credit"</span>)</span>
<span id="cb129-764"><a href="#cb129-764" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(task_credit)</span>
<span id="cb129-765"><a href="#cb129-765" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb129-766"><a href="#cb129-766" aria-hidden="true" tabindex="-1"></a>learner<span class="sc">$</span><span class="fu">train</span>(task_credit)</span>
<span id="cb129-767"><a href="#cb129-767" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> learner<span class="sc">$</span><span class="fu">predict</span>(task_credit)</span>
<span id="cb129-768"><a href="#cb129-768" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(predictions)</span>
<span id="cb129-769"><a href="#cb129-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-770"><a href="#cb129-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-771"><a href="#cb129-771" aria-hidden="true" tabindex="-1"></a>Changing the prediction threshold allows to address this without having to adjust the hyperparameters of the learner or retrain the model.</span>
<span id="cb129-772"><a href="#cb129-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-773"><a href="#cb129-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-thresholding-2}</span></span>
<span id="cb129-774"><a href="#cb129-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the german_credit dataset with adjusted threshold."</span></span>
<span id="cb129-775"><a href="#cb129-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A stacked bar plot of predicted values in one bar and ground truth values in the other. The more prevalent class is now predicted less often and the agreement with the ground truth data is better."</span></span>
<span id="cb129-776"><a href="#cb129-776" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="fl">0.7</span>)</span>
<span id="cb129-777"><a href="#cb129-777" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(predictions)</span>
<span id="cb129-778"><a href="#cb129-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-779"><a href="#cb129-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-780"><a href="#cb129-780" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb129-781"><a href="#cb129-781" aria-hidden="true" tabindex="-1"></a>Thresholds can be tuned automatically with respect to prediction performance with the <span class="in">`r mlr3pipelines`</span> package using <span class="in">`r ref("mlr_pipeops_tunethreshold", text = "PipeOpTuneThreshold")`</span>.</span>
<span id="cb129-782"><a href="#cb129-782" aria-hidden="true" tabindex="-1"></a>This is covered in @sec-pipelines.</span>
<span id="cb129-783"><a href="#cb129-783" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb129-784"><a href="#cb129-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-785"><a href="#cb129-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-786"><a href="#cb129-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-787"><a href="#cb129-787" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Thresholding For Multiple Classes {.unnumbered .unlisted}</span></span>
<span id="cb129-788"><a href="#cb129-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-789"><a href="#cb129-789" aria-hidden="true" tabindex="-1"></a>For classification tasks with more than two classes you can also adjust the prediction threshold, which is 0.5 for each class by default.</span>
<span id="cb129-790"><a href="#cb129-790" aria-hidden="true" tabindex="-1"></a>Thresholds work slightly differently with multiple classes:</span>
<span id="cb129-791"><a href="#cb129-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-792"><a href="#cb129-792" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The probability for a data point is divided by each class threshold resulting in <span class="in">`n`</span> ratios for <span class="in">`n`</span> classes.</span>
<span id="cb129-793"><a href="#cb129-793" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The highest ratio is selected (ties are random by default).</span>
<span id="cb129-794"><a href="#cb129-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-795"><a href="#cb129-795" aria-hidden="true" tabindex="-1"></a>Lowering the threshold for a class means that it is more likely to be predicted and raising it has the opposite effect.</span>
<span id="cb129-796"><a href="#cb129-796" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("datasets::zoo", text = "zoo")`</span> dataset illustrates this concept nicely.  </span>
<span id="cb129-797"><a href="#cb129-797" aria-hidden="true" tabindex="-1"></a>When trained normally some classes are not predicted at all:</span>
<span id="cb129-798"><a href="#cb129-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-799"><a href="#cb129-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-800"><a href="#cb129-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-thresholding-3}</span></span>
<span id="cb129-801"><a href="#cb129-801" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the zoo dataset."</span></span>
<span id="cb129-802"><a href="#cb129-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A stacked bar plot of predicted values in one bar and ground truth values in the other. Some classes are predicted more often than in the ground truth data, some less often."</span></span>
<span id="cb129-803"><a href="#cb129-803" aria-hidden="true" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"zoo"</span>)</span>
<span id="cb129-804"><a href="#cb129-804" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb129-805"><a href="#cb129-805" aria-hidden="true" tabindex="-1"></a>learner<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb129-806"><a href="#cb129-806" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> learner<span class="sc">$</span><span class="fu">predict</span>(task)</span>
<span id="cb129-807"><a href="#cb129-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-808"><a href="#cb129-808" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(preds)</span>
<span id="cb129-809"><a href="#cb129-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-810"><a href="#cb129-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-811"><a href="#cb129-811" aria-hidden="true" tabindex="-1"></a>The classes <span class="in">`amphibian`</span> and <span class="in">`insect`</span> are never predicted. </span>
<span id="cb129-812"><a href="#cb129-812" aria-hidden="true" tabindex="-1"></a>On the other hand, the classes <span class="in">`mollusc`</span> and <span class="in">`reptile`</span> are predicted more often than they appear in the truth data.</span>
<span id="cb129-813"><a href="#cb129-813" aria-hidden="true" tabindex="-1"></a>We can address this by lowering the threshold for <span class="in">`amphibian`</span> and <span class="in">`insect`</span>.</span>
<span id="cb129-814"><a href="#cb129-814" aria-hidden="true" tabindex="-1"></a><span class="in">`$set_threshold()`</span> can be given a named list to set the threshold for all classes at once:</span>
<span id="cb129-815"><a href="#cb129-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-816"><a href="#cb129-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-thresholding-4}</span></span>
<span id="cb129-817"><a href="#cb129-817" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparing predicted and ground truth values for the zoo dataset with adjusted thresholds."</span></span>
<span id="cb129-818"><a href="#cb129-818" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "A stacked bar plot of predicted values in one bar and ground truth values in the other. The agreement between predicted and ground truth data is better with the adjusted prediction thresholds."</span></span>
<span id="cb129-819"><a href="#cb129-819" aria-hidden="true" tabindex="-1"></a><span class="co"># c("mammal", "bird", "reptile", "fish", "amphibian", "insect", "mollusc.et.al")</span></span>
<span id="cb129-820"><a href="#cb129-820" aria-hidden="true" tabindex="-1"></a>new_thresh <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)</span>
<span id="cb129-821"><a href="#cb129-821" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(new_thresh) <span class="ot">=</span> task<span class="sc">$</span>class_names</span>
<span id="cb129-822"><a href="#cb129-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-823"><a href="#cb129-823" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(preds<span class="sc">$</span><span class="fu">set_threshold</span>(new_thresh))</span>
<span id="cb129-824"><a href="#cb129-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-825"><a href="#cb129-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-826"><a href="#cb129-826" aria-hidden="true" tabindex="-1"></a>We can again see that adjusting the thresholds results in better predictive performance, without having to retrain a model.</span>
<span id="cb129-827"><a href="#cb129-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-828"><a href="#cb129-828" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Task Types {#sec-task-types-add}</span></span>
<span id="cb129-829"><a href="#cb129-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-830"><a href="#cb129-830" aria-hidden="true" tabindex="-1"></a>In addition to regression and classification, <span class="in">`r mlr3`</span> supports more types of tasks:</span>
<span id="cb129-831"><a href="#cb129-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-832"><a href="#cb129-832" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clustering (<span class="in">`r ref("mlr3cluster::TaskClust")`</span> in package <span class="in">`r mlr3cluster`</span>): An unsupervised task to identify similar groups within the feature space.</span>
<span id="cb129-833"><a href="#cb129-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-834"><a href="#cb129-834" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Survival (<span class="in">`r ref("mlr3proba::TaskSurv")`</span> in package <span class="in">`r mlr3proba`</span>): The target is the (right-censored) time to an event.</span>
<span id="cb129-835"><a href="#cb129-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-836"><a href="#cb129-836" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Density (<span class="in">`r ref("mlr3proba::TaskDens")`</span> in package <span class="in">`r mlr3proba`</span>): An unsupervised task to estimate the undetectable underlying probability distribution, based on observed data (as a numeric vector or a one-column matrix-like object).</span>
<span id="cb129-837"><a href="#cb129-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-838"><a href="#cb129-838" aria-hidden="true" tabindex="-1"></a>Other task types that are less common are described in @sec-special.</span>
<span id="cb129-839"><a href="#cb129-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-840"><a href="#cb129-840" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Learners {#sec-lrns-add}</span></span>
<span id="cb129-841"><a href="#cb129-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-842"><a href="#cb129-842" aria-hidden="true" tabindex="-1"></a>As mentioned above, <span class="in">`r mlr3`</span> supports many learners.</span>
<span id="cb129-843"><a href="#cb129-843" aria-hidden="true" tabindex="-1"></a>They can be accessed through three packages: the <span class="in">`r mlr3`</span> package, the <span class="in">`r mlr3learners`</span> package, and the <span class="in">`r mlr3extralearners`</span> package.</span>
<span id="cb129-844"><a href="#cb129-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-845"><a href="#cb129-845" aria-hidden="true" tabindex="-1"></a>The list of learners included in the <span class="in">`r mlr3`</span> package is dliberately small to avoid large sets of dependencies for this core package:</span>
<span id="cb129-846"><a href="#cb129-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-847"><a href="#cb129-847" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Featureless classifier <span class="in">`r ref("mlr_learners_classif.featureless", text = "classif.featureless")`</span>: Simple baseline classification learner.</span>
<span id="cb129-848"><a href="#cb129-848" aria-hidden="true" tabindex="-1"></a>  Predicts the label that is most frequent in the training set. It can be used as a "fallback learner" to make predictions if another, more sophisticated, learner fails for some reason.</span>
<span id="cb129-849"><a href="#cb129-849" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Featureless regressor <span class="in">`r ref("mlr_learners_regr.featureless", text = "regr.featureless")`</span>: Simple baseline regression learner.</span>
<span id="cb129-850"><a href="#cb129-850" aria-hidden="true" tabindex="-1"></a>  Predicts the mean of the target values in the training set.</span>
<span id="cb129-851"><a href="#cb129-851" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Rpart decision tree learner <span class="in">`r ref("mlr_learners_classif.rpart", text = "classif.rpart")`</span>: Tree learner from <span class="in">`r ref_pkg("rpart")`</span>.</span>
<span id="cb129-852"><a href="#cb129-852" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Rpart regression tree learner <span class="in">`r ref("mlr_learners_regr.rpart", text = "regr.rpart")`</span>: Tree learner from <span class="in">`r ref_pkg("rpart")`</span>.</span>
<span id="cb129-853"><a href="#cb129-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-854"><a href="#cb129-854" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r mlr3learners`</span> package contains cherry-picked implementations of the most popular machine learning methods:</span>
<span id="cb129-855"><a href="#cb129-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-856"><a href="#cb129-856" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Linear (<span class="in">`r ref("mlr_learners_regr.lm", text = "regr.lm")`</span>) and logistic (<span class="in">`r ref("mlr_learners_classif.log_reg", text = "classif.log_reg")`</span>) regression.</span>
<span id="cb129-857"><a href="#cb129-857" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Penalized Generalized Linear Models (<span class="in">`r ref("mlr_learners_regr.glmnet", text = "regr.glmnet")`</span>, <span class="in">`r ref("mlr_learners_classif.glmnet", text = "classif.glmnet")`</span>), possibly with built-in optimization of the penalization parameter (<span class="in">`r ref("mlr_learners_regr.cv_glmnet", text = "regr.cv_glmnet")`</span>, <span class="in">`r ref("mlr_learners_classif.cv_glmnet", text = "classif.cv_glmnet")`</span>).</span>
<span id="cb129-858"><a href="#cb129-858" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>(Kernelized) $k$-Nearest Neighbors regression (<span class="in">`r ref("mlr_learners_regr.kknn", text = "regr.kknn")`</span>) and classification (<span class="in">`r ref("mlr_learners_classif.kknn", text = "classif.kknn")`</span>).</span>
<span id="cb129-859"><a href="#cb129-859" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Kriging / Gaussian Process Regression (<span class="in">`r ref("mlr_learners_regr.km", text = "regr.km")`</span>).</span>
<span id="cb129-860"><a href="#cb129-860" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Linear (<span class="in">`r ref("mlr_learners_classif.lda", text = "classif.lda")`</span>) and Quadratic (<span class="in">`r ref("mlr_learners_classif.qda", text = "classif.qda")`</span>) Discriminant Analysis.</span>
<span id="cb129-861"><a href="#cb129-861" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Naïve Bayes Classification (<span class="in">`r ref("mlr_learners_classif.naive_bayes", text = "classif.naive_bayes")`</span>).</span>
<span id="cb129-862"><a href="#cb129-862" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Support-Vector machines (<span class="in">`r ref("mlr_learners_regr.svm", text = "regr.svm")`</span>, <span class="in">`r ref("mlr_learners_classif.svm", text = "classif.svm")`</span>).</span>
<span id="cb129-863"><a href="#cb129-863" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Gradient Boosting (<span class="in">`r ref("mlr_learners_regr.xgboost", text = "regr.xgboost")`</span>, <span class="in">`r ref("mlr_learners_classif.xgboost", text = "classif.xgboost")`</span>).</span>
<span id="cb129-864"><a href="#cb129-864" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Random Forests for regression and classification (<span class="in">`r ref("mlr_learners_regr.ranger", text = "regr.ranger")`</span>, <span class="in">`r ref("mlr_learners_classif.ranger", text = "classif.ranger")`</span>).</span>
<span id="cb129-865"><a href="#cb129-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-866"><a href="#cb129-866" aria-hidden="true" tabindex="-1"></a>A complete list of supported learners across all <span class="in">`r mlr3`</span> packages is hosted on <span class="in">`r link("https://mlr-org.com/learners.html", "our website")`</span>.</span>
<span id="cb129-867"><a href="#cb129-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-868"><a href="#cb129-868" aria-hidden="true" tabindex="-1"></a>The dictionary <span class="in">`r ref("mlr_learners")`</span> contains the supported learners and changes as packages are loaded.</span>
<span id="cb129-869"><a href="#cb129-869" aria-hidden="true" tabindex="-1"></a>At the time of writing, <span class="in">`r mlr3`</span> supports six learners, <span class="in">`r ref("mlr3learners")`</span> 21 learners, <span class="in">`r ref("mlr3extralearners")`</span> 88 learners, <span class="in">`r ref("mlr3proba")`</span> five learners, and <span class="in">`r ref("mlr3cluster")`</span> 19 learners.</span>
<span id="cb129-870"><a href="#cb129-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-871"><a href="#cb129-871" aria-hidden="true" tabindex="-1"></a><span class="fu">### Listing Learners {#sec-lrns-add-list}</span></span>
<span id="cb129-872"><a href="#cb129-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-873"><a href="#cb129-873" aria-hidden="true" tabindex="-1"></a>You can list all learners by converting the <span class="in">`r ref("mlr_learners")`</span> dictionary into a <span class="in">`data.table`</span>:</span>
<span id="cb129-874"><a href="#cb129-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-875"><a href="#cb129-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-list}</span></span>
<span id="cb129-876"><a href="#cb129-876" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners)</span>
<span id="cb129-877"><a href="#cb129-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-878"><a href="#cb129-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-879"><a href="#cb129-879" aria-hidden="true" tabindex="-1"></a>The resulting <span class="in">`data.table`</span> contains a lot of meta-data that is useful for identifying learners that have particular properties.</span>
<span id="cb129-880"><a href="#cb129-880" aria-hidden="true" tabindex="-1"></a>For example, we can list all learners that support regression problems:</span>
<span id="cb129-881"><a href="#cb129-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-882"><a href="#cb129-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-list-regr}</span></span>
<span id="cb129-883"><a href="#cb129-883" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"regr"</span>]</span>
<span id="cb129-884"><a href="#cb129-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-885"><a href="#cb129-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-886"><a href="#cb129-886" aria-hidden="true" tabindex="-1"></a>We can check multiple conditions, to for example find all learners that support regression problems and can predict standard errors:</span>
<span id="cb129-887"><a href="#cb129-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-888"><a href="#cb129-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-regr-se}</span></span>
<span id="cb129-889"><a href="#cb129-889" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"regr"</span> <span class="sc">&amp;</span></span>
<span id="cb129-890"><a href="#cb129-890" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(predict_types, <span class="cf">function</span>(x) <span class="st">"se"</span> <span class="sc">%in%</span> x)]</span>
<span id="cb129-891"><a href="#cb129-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-892"><a href="#cb129-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-893"><a href="#cb129-893" aria-hidden="true" tabindex="-1"></a>Or we can list all learners that support classification problems and missing feature values:</span>
<span id="cb129-894"><a href="#cb129-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-895"><a href="#cb129-895" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-classif-missings}</span></span>
<span id="cb129-896"><a href="#cb129-896" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners)[task_type <span class="sc">==</span> <span class="st">"classif"</span> <span class="sc">&amp;</span></span>
<span id="cb129-897"><a href="#cb129-897" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(properties, <span class="cf">function</span>(x) <span class="st">"missings"</span> <span class="sc">%in%</span> x)]</span>
<span id="cb129-898"><a href="#cb129-898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb129-899"><a href="#cb129-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-900"><a href="#cb129-900" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb129-901"><a href="#cb129-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-902"><a href="#cb129-902" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Using the <span class="in">`r ref("mlr_tasks_sonar", text = "Sonar dataset")`</span>, measure the classification error (<span class="in">`classif.ce`</span>) of a classification tree model (<span class="in">`classif.rpart`</span>) trained with default hyperparameters on 80% of the data and tested on the remaining 20%.</span>
<span id="cb129-903"><a href="#cb129-903" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Give the true positive, false positive, true negative, and false negative rates of the predictions made by the model in problem 1.</span>
<span id="cb129-904"><a href="#cb129-904" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Change the threshold of the model from problem 1 such that the false positive rate is lower than the false negative rate.</span>
<span id="cb129-905"><a href="#cb129-905" aria-hidden="true" tabindex="-1"></a>Give a reason why you might do this.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">All content licenced under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.</div>   
      <div class="nav-footer-center"><a href="https://mlr-org.com">Website</a> | <a href="https://github.com/mlr-org/mlr3book">GitHub</a> | <a href="https://mlr-org.com/gallery">Gallery</a> | <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">Mattermost</a></div>
    <div class="nav-footer-right">Written with <i class="bi bi-heart-fill"></i> for #rstats, ML and FOSS by the mlr-org team.</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>